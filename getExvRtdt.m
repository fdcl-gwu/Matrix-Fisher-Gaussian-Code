function [ ExvRtdt ] = getExvRtdt( omega, Miu, Sigma, P, U, s, V, H, EQ, EQQQ, Utdt, Stdt, Vtdt, dt, omegaLocal, defQS )

% ExvRpt
if omegaLocal
    UT = Utdt'*U;
    VT = Vtdt'*expRot((omega+Miu)*dt)'*V;
    ST = UT'*Stdt*VT;
else
    UT = Utdt'*expRot((omega+Miu)*dt)*U;
    VT = Vtdt'*V;
    ST = UT'*Stdt*VT;
end

if defQS
    EvRTt = UT*vee(EQ*ST'-ST*EQ');

    EvRvRTt = [ST(2,2)*EQ(2,2)+ST(3,3)*EQ(3,3), -ST(1,2)*EQ(2,2), -ST(1,3)*EQ(3,3)
        -ST(2,1)*EQ(1,1), ST(1,1)*EQ(1,1)+ST(3,3)*EQ(3,3), -ST(2,3)*EQ(3,3)
        -ST(3,1)*EQ(1,1), -ST(3,2)*EQ(2,2), ST(1,1)*EQ(1,1)+ST(2,2)*EQ(2,2)];
    EvRvRTt = EvRvRTt*UT';
else
    EvRTt = VT*vee(ST'*EQ-EQ'*ST);

    EvRvRTt = [ST(2,2)*EQ(2,2)+ST(3,3)*EQ(3,3), -ST(2,1)*EQ(2,2), -ST(3,1)*EQ(3,3)
        -ST(1,2)*EQ(1,1), ST(1,1)*EQ(1,1)+ST(3,3)*EQ(3,3), -ST(3,2)*EQ(3,3)
        -ST(1,3)*EQ(1,1), -ST(2,3)*EQ(2,2), ST(1,1)*EQ(1,1)+ST(2,2)*EQ(2,2)];
    EvRvRTt = EvRvRTt*VT';
end

ExvRTt = Miu*EvRTt'+P*EvRvRTt;

% ExvRhatxwpt
SigmaMInv = diag([s(2)+s(3),s(1)+s(3),s(1)+s(2)]);
Sigmac = Sigma-P*SigmaMInv*P';

if omegaLocal
    PV = P'*V;
    if defQS
        EGammat = [ST(2,2)*EQ(3,3)+ST(3,3)*EQ(2,2), -ST(2,1)*EQ(3,3), -ST(3,1)*EQ(2,2);
            -ST(1,2)*EQ(3,3), ST(1,1)*EQ(3,3)+ST(3,3)*EQ(1,1), -ST(3,2)*EQ(1,1);
            -ST(1,3)*EQ(2,2), -ST(2,3)*EQ(1,1), ST(1,1)*EQ(2,2)+ST(2,2)*EQ(1,1)];
        
        EvRPVGammat(1) = (PV(3,3)*ST(3,2)+PV(2,3)*ST(2,2)-PV(3,2)*ST(3,3)-PV(2,2)*ST(2,3))*EQ(1,1)...
            +(PV(1,3)*ST(2,1)-PV(1,1)*ST(2,3))*EQ(2,2)+(PV(1,1)*ST(3,2)-PV(1,2)*ST(3,1))*EQ(3,3);
        EvRPVGammat(2) = (PV(1,1)*ST(1,3)+PV(3,1)*ST(3,3)-PV(1,3)*ST(1,1)-PV(3,3)*ST(3,1))*EQ(2,2)...
            +(PV(2,1)*ST(3,2)-PV(2,2)*ST(3,1))*EQ(3,3)+(PV(2,2)*ST(1,3)-PV(2,3)*ST(1,2))*EQ(1,1);
        EvRPVGammat(3) = (PV(2,2)*ST(2,1)+PV(1,2)*ST(1,1)-PV(2,1)*ST(2,2)-PV(1,1)*ST(1,2))*EQ(3,3)...
            +(PV(3,2)*ST(1,3)-PV(3,3)*ST(1,2))*EQ(1,1)+(PV(3,3)*ST(2,1)-PV(3,1)*ST(2,3))*EQ(2,2);

        EvRvRPVGammat(1,1) = (PV(1,1)*ST(3,3)*s(2)^2-PV(1,3)*ST(3,1)*s(2)^2+PV(1,1)*ST(3,3)*s(3)^2-PV(1,3)*ST(3,1)*s(3)^2)*EQQQ(5,6,6)...
            +(2*PV(1,3)*ST(3,1)*s(2)*s(3)-2*PV(1,1)*ST(3,3)*s(2)*s(3))*EQQQ(5,6,8)...
            +(PV(1,1)*ST(2,2)*s(2)^2-PV(1,2)*ST(2,1)*s(2)^2+PV(1,1)*ST(2,2)*s(3)^2-PV(1,2)*ST(2,1)*s(3)^2)*EQQQ(9,6,6)...
            +(2*PV(1,2)*ST(2,1)*s(2)*s(3)-2*PV(1,1)*ST(2,2)*s(2)*s(3))*EQQQ(9,6,8)...
            +(PV(2,3)*ST(3,2)*s(2)*s(3)-PV(2,2)*ST(3,3)*s(2)*s(3)+PV(3,2)*ST(2,3)*s(2)*s(3)-PV(3,3)*ST(2,2)*s(2)*s(3))*EQQQ(2,6,7)...
            +(PV(3,3)*ST(2,2)*s(2)^2-PV(3,2)*ST(2,3)*s(2)^2+PV(2,2)*ST(3,3)*s(3)^2-PV(2,3)*ST(3,2)*s(3)^2)*EQQQ(4,3,6)...
            +(PV(2,2)*ST(3,3)*s(1)*s(2)-PV(2,3)*ST(3,2)*s(1)*s(2)+PV(3,2)*ST(2,3)*s(1)*s(2)-PV(3,3)*ST(2,2)*s(1)*s(2))*EQQQ(2,6,3)...
            +(PV(2,3)*ST(3,2)*s(1)*s(3)-PV(2,2)*ST(3,3)*s(1)*s(3)-PV(3,2)*ST(2,3)*s(1)*s(3)+PV(3,3)*ST(2,2)*s(1)*s(3))*EQQQ(3,8,2);
        EvRvRPVGammat(1,2) = (PV(1,2)*ST(3,3)*s(2)^2-PV(1,3)*ST(3,2)*s(2)^2+PV(1,2)*ST(3,3)*s(3)^2-PV(1,3)*ST(3,2)*s(3)^2)*EQQQ(1,6,6)...
            +(2*PV(1,3)*ST(3,2)*s(2)*s(3)-2*PV(1,2)*ST(3,3)*s(2)*s(3))*EQQQ(1,6,8)...
            +(PV(1,2)*ST(1,1)*s(2)^2-PV(1,1)*ST(1,2)*s(2)^2-PV(1,1)*ST(1,2)*s(3)^2+PV(1,2)*ST(1,1)*s(3)^2)*EQQQ(9,6,6)...
            +(2*PV(1,1)*ST(1,2)*s(2)*s(3)-2*PV(1,2)*ST(1,1)*s(2)*s(3))*EQQQ(9,6,8)...
            +(PV(3,3)*ST(1,2)*s(2)*s(3)-PV(3,2)*ST(1,3)*s(2)*s(3)-PV(2,1)*ST(3,3)*s(1)*s(3)+PV(2,3)*ST(3,1)*s(1)*s(3)+PV(3,1)*ST(3,2)*s(1)*s(2)-PV(3,2)*ST(3,1)*s(1)*s(2))*EQQQ(2,6,7)...
            +(PV(3,2)*ST(1,3)*s(2)^2-PV(3,3)*ST(1,2)*s(2)^2+PV(2,1)*ST(3,3)*s(1)*s(2)-PV(2,3)*ST(3,1)*s(1)*s(2)-PV(3,1)*ST(3,2)*s(1)*s(3)+PV(3,2)*ST(3,1)*s(1)*s(3))*EQQQ(4,3,6)...
            +(PV(2,1)*ST(3,3)*s(3)^2-PV(2,3)*ST(3,1)*s(3)^2-PV(3,2)*ST(1,3)*s(1)*s(2)+PV(3,3)*ST(1,2)*s(1)*s(2)+PV(3,1)*ST(3,2)*s(2)*s(3)-PV(3,2)*ST(3,1)*s(2)*s(3))*EQQQ(2,6,3)...
            +(PV(3,2)*ST(3,1)*s(2)^2-PV(3,1)*ST(3,2)*s(2)^2+PV(3,2)*ST(1,3)*s(1)*s(3)-PV(3,3)*ST(1,2)*s(1)*s(3)-PV(2,1)*ST(3,3)*s(2)*s(3)+PV(2,3)*ST(3,1)*s(2)*s(3))*EQQQ(3,8,2);
        EvRvRPVGammat(1,3) = (PV(1,3)*ST(2,2)*s(2)^2-PV(1,2)*ST(2,3)*s(2)^2-PV(1,2)*ST(2,3)*s(3)^2+PV(1,3)*ST(2,2)*s(3)^2)*EQQQ(1,6,6)...
            +(2*PV(1,2)*ST(2,3)*s(2)*s(3)-2*PV(1,3)*ST(2,2)*s(2)*s(3))*EQQQ(1,6,8)...
            +(PV(1,3)*ST(1,1)*s(2)^2-PV(1,1)*ST(1,3)*s(2)^2-PV(1,1)*ST(1,3)*s(3)^2+PV(1,3)*ST(1,1)*s(3)^2)*EQQQ(5,6,6)...
            +(2*PV(1,1)*ST(1,3)*s(2)*s(3)-2*PV(1,3)*ST(1,1)*s(2)*s(3))*EQQQ(5,6,8)...
            +(PV(2,2)*ST(1,3)*s(2)*s(3)-PV(2,3)*ST(1,2)*s(2)*s(3)+PV(2,1)*ST(2,3)*s(1)*s(3)-PV(2,3)*ST(2,1)*s(1)*s(3)-PV(3,1)*ST(2,2)*s(1)*s(2)+PV(3,2)*ST(2,1)*s(1)*s(2))*EQQQ(2,6,7)...
            +(PV(2,3)*ST(1,2)*s(3)^2-PV(2,2)*ST(1,3)*s(3)^2-PV(2,1)*ST(2,3)*s(1)*s(2)+PV(2,3)*ST(2,1)*s(1)*s(2)+PV(3,1)*ST(2,2)*s(1)*s(3)-PV(3,2)*ST(2,1)*s(1)*s(3))*EQQQ(4,3,6)...
            +(PV(2,3)*ST(2,1)*s(3)^2-PV(2,1)*ST(2,3)*s(3)^2-PV(2,2)*ST(1,3)*s(1)*s(2)+PV(2,3)*ST(1,2)*s(1)*s(2)-PV(3,1)*ST(2,2)*s(2)*s(3)+PV(3,2)*ST(2,1)*s(2)*s(3))*EQQQ(2,6,3)...
            +(PV(3,1)*ST(2,2)*s(2)^2-PV(3,2)*ST(2,1)*s(2)^2+PV(2,2)*ST(1,3)*s(1)*s(3)-PV(2,3)*ST(1,2)*s(1)*s(3)+PV(2,1)*ST(2,3)*s(2)*s(3)-PV(2,3)*ST(2,1)*s(2)*s(3))*EQQQ(3,8,2);
        EvRvRPVGammat(2,1) = (PV(2,1)*ST(3,3)*s(1)^2-PV(2,3)*ST(3,1)*s(1)^2+PV(2,1)*ST(3,3)*s(3)^2-PV(2,3)*ST(3,1)*s(3)^2)*EQQQ(5,3,3)...
            +(2*PV(2,3)*ST(3,1)*s(1)*s(3)-2*PV(2,1)*ST(3,3)*s(1)*s(3))*EQQQ(5,3,7)...
            +(PV(2,1)*ST(2,2)*s(1)^2-PV(2,2)*ST(2,1)*s(1)^2+PV(2,1)*ST(2,2)*s(3)^2-PV(2,2)*ST(2,1)*s(3)^2)*EQQQ(9,3,3)...
            +(2*PV(2,2)*ST(2,1)*s(1)*s(3)-2*PV(2,1)*ST(2,2)*s(1)*s(3))*EQQQ(9,3,7)...
            +(PV(1,3)*ST(3,2)*s(2)*s(3)-PV(1,2)*ST(3,3)*s(2)*s(3)-PV(3,1)*ST(2,3)*s(1)*s(3)+PV(3,3)*ST(2,1)*s(1)*s(3)-PV(3,1)*ST(3,2)*s(1)*s(2)+PV(3,2)*ST(3,1)*s(1)*s(2))*EQQQ(2,6,7)...
            +(PV(1,2)*ST(3,3)*s(3)^2-PV(1,3)*ST(3,2)*s(3)^2-PV(3,1)*ST(2,3)*s(1)*s(2)+PV(3,3)*ST(2,1)*s(1)*s(2)-PV(3,1)*ST(3,2)*s(1)*s(3)+PV(3,2)*ST(3,1)*s(1)*s(3))*EQQQ(4,3,6)...
            +(PV(3,1)*ST(2,3)*s(1)^2-PV(3,3)*ST(2,1)*s(1)^2+PV(1,2)*ST(3,3)*s(1)*s(2)-PV(1,3)*ST(3,2)*s(1)*s(2)+PV(3,1)*ST(3,2)*s(2)*s(3)-PV(3,2)*ST(3,1)*s(2)*s(3))*EQQQ(2,6,3)...
            +(PV(3,1)*ST(3,2)*s(1)^2-PV(3,2)*ST(3,1)*s(1)^2-PV(1,2)*ST(3,3)*s(1)*s(3)+PV(1,3)*ST(3,2)*s(1)*s(3)+PV(3,1)*ST(2,3)*s(2)*s(3)-PV(3,3)*ST(2,1)*s(2)*s(3))*EQQQ(3,8,2);
        EvRvRPVGammat(2,2) = (PV(2,2)*ST(3,3)*s(1)^2-PV(2,3)*ST(3,2)*s(1)^2+PV(2,2)*ST(3,3)*s(3)^2-PV(2,3)*ST(3,2)*s(3)^2)*EQQQ(1,3,3)...
            +(2*PV(2,3)*ST(3,2)*s(1)*s(3)-2*PV(2,2)*ST(3,3)*s(1)*s(3))*EQQQ(1,3,7)...
            +(PV(2,2)*ST(1,1)*s(1)^2-PV(2,1)*ST(1,2)*s(1)^2-PV(2,1)*ST(1,2)*s(3)^2+PV(2,2)*ST(1,1)*s(3)^2)*EQQQ(9,3,3)...
            +(2*PV(2,1)*ST(1,2)*s(1)*s(3)-2*PV(2,2)*ST(1,1)*s(1)*s(3))*EQQQ(9,3,7)...
            +(PV(1,3)*ST(3,1)*s(1)*s(3)-PV(1,1)*ST(3,3)*s(1)*s(3)+PV(3,1)*ST(1,3)*s(1)*s(3)-PV(3,3)*ST(1,1)*s(1)*s(3))*EQQQ(2,6,7)...
            +(PV(1,1)*ST(3,3)*s(1)*s(2)-PV(1,3)*ST(3,1)*s(1)*s(2)+PV(3,1)*ST(1,3)*s(1)*s(2)-PV(3,3)*ST(1,1)*s(1)*s(2))*EQQQ(4,3,6)...
            +(PV(3,3)*ST(1,1)*s(1)^2-PV(3,1)*ST(1,3)*s(1)^2+PV(1,1)*ST(3,3)*s(3)^2-PV(1,3)*ST(3,1)*s(3)^2)*EQQQ(2,6,3)...
            +(PV(1,3)*ST(3,1)*s(2)*s(3)-PV(1,1)*ST(3,3)*s(2)*s(3)-PV(3,1)*ST(1,3)*s(2)*s(3)+PV(3,3)*ST(1,1)*s(2)*s(3))*EQQQ(3,8,2);
        EvRvRPVGammat(2,3) = (PV(2,3)*ST(2,2)*s(1)^2-PV(2,2)*ST(2,3)*s(1)^2-PV(2,2)*ST(2,3)*s(3)^2+PV(2,3)*ST(2,2)*s(3)^2)*EQQQ(1,3,3)...
            +(2*PV(2,2)*ST(2,3)*s(1)*s(3)-2*PV(2,3)*ST(2,2)*s(1)*s(3))*EQQQ(1,3,7)...
            +(PV(2,3)*ST(1,1)*s(1)^2-PV(2,1)*ST(1,3)*s(1)^2-PV(2,1)*ST(1,3)*s(3)^2+PV(2,3)*ST(1,1)*s(3)^2)*EQQQ(5,3,3)...
            +(2*PV(2,1)*ST(1,3)*s(1)*s(3)-2*PV(2,3)*ST(1,1)*s(1)*s(3))*EQQQ(5,3,7)...
            +(PV(1,2)*ST(1,3)*s(2)*s(3)-PV(1,3)*ST(1,2)*s(2)*s(3)+PV(1,1)*ST(2,3)*s(1)*s(3)-PV(1,3)*ST(2,1)*s(1)*s(3)+PV(3,1)*ST(1,2)*s(1)*s(2)-PV(3,2)*ST(1,1)*s(1)*s(2))*EQQQ(2,6,7)...
            +(PV(1,3)*ST(1,2)*s(3)^2-PV(1,2)*ST(1,3)*s(3)^2-PV(1,1)*ST(2,3)*s(1)*s(2)+PV(1,3)*ST(2,1)*s(1)*s(2)+PV(3,1)*ST(1,2)*s(1)*s(3)-PV(3,2)*ST(1,1)*s(1)*s(3))*EQQQ(4,3,6)...
            +(PV(1,3)*ST(2,1)*s(3)^2-PV(1,1)*ST(2,3)*s(3)^2-PV(1,2)*ST(1,3)*s(1)*s(2)+PV(1,3)*ST(1,2)*s(1)*s(2)-PV(3,1)*ST(1,2)*s(2)*s(3)+PV(3,2)*ST(1,1)*s(2)*s(3))*EQQQ(2,6,3)...
            +(PV(3,2)*ST(1,1)*s(1)^2-PV(3,1)*ST(1,2)*s(1)^2+PV(1,2)*ST(1,3)*s(1)*s(3)-PV(1,3)*ST(1,2)*s(1)*s(3)+PV(1,1)*ST(2,3)*s(2)*s(3)-PV(1,3)*ST(2,1)*s(2)*s(3))*EQQQ(3,8,2);
        EvRvRPVGammat(3,1) = (PV(3,1)*ST(3,3)*s(1)^2-PV(3,3)*ST(3,1)*s(1)^2+PV(3,1)*ST(3,3)*s(2)^2-PV(3,3)*ST(3,1)*s(2)^2)*EQQQ(5,2,2)...
            +(2*PV(3,3)*ST(3,1)*s(1)*s(2)-2*PV(3,1)*ST(3,3)*s(1)*s(2))*EQQQ(5,2,4)...
            +(PV(3,1)*ST(2,2)*s(1)^2-PV(3,2)*ST(2,1)*s(1)^2+PV(3,1)*ST(2,2)*s(2)^2-PV(3,2)*ST(2,1)*s(2)^2)*EQQQ(9,2,2)...
            +(2*PV(3,2)*ST(2,1)*s(1)*s(2)-2*PV(3,1)*ST(2,2)*s(1)*s(2))*EQQQ(9,2,4)...
            +(PV(1,2)*ST(2,3)*s(2)*s(3)-PV(1,3)*ST(2,2)*s(2)*s(3)-PV(2,1)*ST(2,3)*s(1)*s(3)+PV(2,3)*ST(2,1)*s(1)*s(3)-PV(2,1)*ST(3,2)*s(1)*s(2)+PV(2,2)*ST(3,1)*s(1)*s(2))*EQQQ(2,6,7)...
            +(PV(1,3)*ST(2,2)*s(2)^2-PV(1,2)*ST(2,3)*s(2)^2-PV(2,1)*ST(2,3)*s(1)*s(2)+PV(2,3)*ST(2,1)*s(1)*s(2)-PV(2,1)*ST(3,2)*s(1)*s(3)+PV(2,2)*ST(3,1)*s(1)*s(3))*EQQQ(4,3,6)...
            +(PV(2,1)*ST(2,3)*s(1)^2-PV(2,3)*ST(2,1)*s(1)^2+PV(1,2)*ST(2,3)*s(1)*s(2)-PV(1,3)*ST(2,2)*s(1)*s(2)+PV(2,1)*ST(3,2)*s(2)*s(3)-PV(2,2)*ST(3,1)*s(2)*s(3))*EQQQ(2,6,3)...
            +(PV(2,1)*ST(3,2)*s(1)^2-PV(2,2)*ST(3,1)*s(1)^2-PV(1,2)*ST(2,3)*s(1)*s(3)+PV(1,3)*ST(2,2)*s(1)*s(3)+PV(2,1)*ST(2,3)*s(2)*s(3)-PV(2,3)*ST(2,1)*s(2)*s(3))*EQQQ(3,8,2);
        EvRvRPVGammat(3,2) = (PV(3,2)*ST(3,3)*s(1)^2-PV(3,3)*ST(3,2)*s(1)^2+PV(3,2)*ST(3,3)*s(2)^2-PV(3,3)*ST(3,2)*s(2)^2)*EQQQ(1,2,2)...
            +(2*PV(3,3)*ST(3,2)*s(1)*s(2)-2*PV(3,2)*ST(3,3)*s(1)*s(2))*EQQQ(1,2,4)...
            +(PV(3,2)*ST(1,1)*s(1)^2-PV(3,1)*ST(1,2)*s(1)^2-PV(3,1)*ST(1,2)*s(2)^2+PV(3,2)*ST(1,1)*s(2)^2)*EQQQ(9,2,2)...
            +(2*PV(3,1)*ST(1,2)*s(1)*s(2)-2*PV(3,2)*ST(1,1)*s(1)*s(2))*EQQQ(9,2,4)...
            +(PV(1,3)*ST(1,2)*s(2)*s(3)-PV(1,2)*ST(1,3)*s(2)*s(3)+PV(2,1)*ST(1,3)*s(1)*s(3)-PV(2,3)*ST(1,1)*s(1)*s(3)+PV(1,1)*ST(3,2)*s(1)*s(2)-PV(1,2)*ST(3,1)*s(1)*s(2))*EQQQ(2,6,7)...
            +(PV(1,2)*ST(1,3)*s(2)^2-PV(1,3)*ST(1,2)*s(2)^2+PV(2,1)*ST(1,3)*s(1)*s(2)-PV(2,3)*ST(1,1)*s(1)*s(2)-PV(1,1)*ST(3,2)*s(1)*s(3)+PV(1,2)*ST(3,1)*s(1)*s(3))*EQQQ(4,3,6)...
            +(PV(2,3)*ST(1,1)*s(1)^2-PV(2,1)*ST(1,3)*s(1)^2-PV(1,2)*ST(1,3)*s(1)*s(2)+PV(1,3)*ST(1,2)*s(1)*s(2)+PV(1,1)*ST(3,2)*s(2)*s(3)-PV(1,2)*ST(3,1)*s(2)*s(3))*EQQQ(2,6,3)...
            +(PV(1,2)*ST(3,1)*s(2)^2-PV(1,1)*ST(3,2)*s(2)^2+PV(1,2)*ST(1,3)*s(1)*s(3)-PV(1,3)*ST(1,2)*s(1)*s(3)-PV(2,1)*ST(1,3)*s(2)*s(3)+PV(2,3)*ST(1,1)*s(2)*s(3))*EQQQ(3,8,2);
        EvRvRPVGammat(3,3) = (PV(3,3)*ST(2,2)*s(1)^2-PV(3,2)*ST(2,3)*s(1)^2-PV(3,2)*ST(2,3)*s(2)^2+PV(3,3)*ST(2,2)*s(2)^2)*EQQQ(1,2,2)...
            +(2*PV(3,2)*ST(2,3)*s(1)*s(2)-2*PV(3,3)*ST(2,2)*s(1)*s(2))*EQQQ(1,2,4)...
            +(PV(3,3)*ST(1,1)*s(1)^2-PV(3,1)*ST(1,3)*s(1)^2-PV(3,1)*ST(1,3)*s(2)^2+PV(3,3)*ST(1,1)*s(2)^2)*EQQQ(5,2,2)...
            +(2*PV(3,1)*ST(1,3)*s(1)*s(2)-2*PV(3,3)*ST(1,1)*s(1)*s(2))*EQQQ(5,2,4)...
            +(PV(1,2)*ST(2,1)*s(1)*s(2)-PV(1,1)*ST(2,2)*s(1)*s(2)+PV(2,1)*ST(1,2)*s(1)*s(2)-PV(2,2)*ST(1,1)*s(1)*s(2))*EQQQ(2,6,7)...
            +(PV(1,1)*ST(2,2)*s(1)*s(3)-PV(1,2)*ST(2,1)*s(1)*s(3)+PV(2,1)*ST(1,2)*s(1)*s(3)-PV(2,2)*ST(1,1)*s(1)*s(3))*EQQQ(4,3,6)...
            +(PV(1,2)*ST(2,1)*s(2)*s(3)-PV(1,1)*ST(2,2)*s(2)*s(3)-PV(2,1)*ST(1,2)*s(2)*s(3)+PV(2,2)*ST(1,1)*s(2)*s(3))*EQQQ(2,6,3)...
            +(PV(2,2)*ST(1,1)*s(1)^2-PV(2,1)*ST(1,2)*s(1)^2+PV(1,1)*ST(2,2)*s(2)^2-PV(1,2)*ST(2,1)*s(2)^2)*EQQQ(3,8,2);
        
        ExvRhatxwpt = dt*(Sigmac*V*EGammat'+Miu*EvRPVGammat+P*EvRvRPVGammat)*UT';
    else
        EGammat = [ST(2,2)*EQ(2,2)+ST(3,3)*EQ(3,3), -ST(1,2)*EQ(1,1), -ST(1,3)*EQ(1,1);
            -ST(2,1)*EQ(2,2), ST(1,1)*EQ(1,1)+ST(3,3)*EQ(3,3), -ST(2,3)*EQ(2,2);
            -ST(3,1)*EQ(3,3), -ST(3,2)*EQ(3,3), ST(1,1)*EQ(1,1)+ST(2,2)*EQ(2,2)];
        
        EvRPVGammat(1) = (PV(2,1)*ST(1,3)-PV(3,1)*ST(1,2))*EQ(1,1)...
            -(PV(3,2)*ST(2,2)+PV(3,3)*ST(2,3)+PV(1,1)*ST(2,3))*EQ(2,2)...
            +(PV(2,2)*ST(3,2)+PV(2,3)*ST(3,3)+PV(1,1)*ST(3,2))*EQ(3,3);
        EvRPVGammat(2) = (PV(3,2)*ST(2,1)-PV(1,2)*ST(2,3))*EQ(2,2)...
            +(PV(3,1)*ST(1,1)+PV(3,3)*ST(1,3)+PV(2,2)*ST(1,3))*EQ(1,1)...
            -(PV(1,1)*ST(3,1)+PV(1,3)*ST(3,3)+PV(2,2)*ST(3,1))*EQ(3,3);
        EvRPVGammat(3) = (PV(1,3)*ST(3,2)-PV(2,3)*ST(3,1))*EQ(3,3)...
            -(PV(2,1)*ST(1,1)+PV(2,2)*ST(1,2)+PV(3,3)*ST(1,2))*EQ(1,1)...
            +(PV(1,1)*ST(2,1)+PV(1,2)*ST(2,2)+PV(3,3)*ST(2,1))*EQ(2,2);

        EvRvRPVGammat(1,1) = (-PV(1,2)*ST(1,2)*s(2)^2-PV(1,2)*ST(1,2)*s(3)^2-PV(1,3)*ST(1,3)*s(2)^2-PV(1,3)*ST(1,3)*s(3)^2)*EQQQ(1,6,6)...
            + (2*PV(1,2)*ST(1,2)*s(2)*s(3)+2*PV(1,3)*ST(1,3)*s(2)*s(3))*EQQQ(1,6,8)...
            + (PV(1,1)*ST(2,2)*s(2)^2+PV(1,1)*ST(2,2)*s(3)^2)*EQQQ(5,6,6)...
            + (-2*PV(1,1)*ST(2,2)*s(2)*s(3))*EQQQ(5,6,8)...
            + (PV(1,1)*ST(3,3)*s(2)^2+PV(1,1)*ST(3,3)*s(3)^2)*EQQQ(9,6,6)...
            + (-2*PV(1,1)*ST(3,3)*s(2)*s(3))*EQQQ(9,6,8)...
            + (PV(2,1)*ST(1,2)*s(2)*s(3)-PV(2,2)*ST(2,2)*s(1)*s(3)+PV(3,1)*ST(1,3)*s(2)*s(3)-PV(2,3)*ST(2,3)*s(1)*s(3)-PV(3,2)*ST(3,2)*s(1)*s(2)-PV(3,3)*ST(3,3)*s(1)*s(2))*EQQQ(2,6,7)...
            + (PV(2,2)*ST(2,2)*s(1)*s(2)-PV(3,1)*ST(1,3)*s(2)^2-PV(2,1)*ST(1,2)*s(3)^2+PV(2,3)*ST(2,3)*s(1)*s(2)+PV(3,2)*ST(3,2)*s(1)*s(3)+PV(3,3)*ST(3,3)*s(1)*s(3))*EQQQ(4,3,6)...
            + (PV(2,2)*ST(2,2)*s(3)^2+PV(2,3)*ST(2,3)*s(3)^2-PV(2,1)*ST(1,2)*s(1)*s(2)+PV(3,1)*ST(1,3)*s(1)*s(2)-PV(3,2)*ST(3,2)*s(2)*s(3)-PV(3,3)*ST(3,3)*s(2)*s(3))*EQQQ(2,6,3)...
            + (PV(3,2)*ST(3,2)*s(2)^2+PV(3,3)*ST(3,3)*s(2)^2+PV(2,1)*ST(1,2)*s(1)*s(3)-PV(3,1)*ST(1,3)*s(1)*s(3)-PV(2,2)*ST(2,2)*s(2)*s(3)-PV(2,3)*ST(2,3)*s(2)*s(3))*EQQQ(3,8,2);
        EvRvRPVGammat(1,2) = (PV(1,2)*ST(1,1)*s(2)^2+PV(1,2)*ST(1,1)*s(3)^2)*EQQQ(1,6,6)...
            + (-2*PV(1,2)*ST(1,1)*s(2)*s(3))*EQQQ(1,6,8)...
            + (-PV(1,1)*ST(2,1)*s(2)^2-PV(1,1)*ST(2,1)*s(3)^2-PV(1,3)*ST(2,3)*s(2)^2-PV(1,3)*ST(2,3)*s(3)^2)*EQQQ(5,6,6)...
            + (2*PV(1,1)*ST(2,1)*s(2)*s(3)+2*PV(1,3)*ST(2,3)*s(2)*s(3))*EQQQ(5,6,8)...
            + (PV(1,2)*ST(3,3)*s(2)^2+PV(1,2)*ST(3,3)*s(3)^2)*EQQQ(9,6,6)...
            + (-2*PV(1,2)*ST(3,3)*s(2)*s(3))*EQQQ(9,6,8)...
            + (PV(2,2)*ST(2,1)*s(1)*s(3)-PV(2,3)*ST(1,3)*s(2)*s(3)-PV(2,1)*ST(1,1)*s(2)*s(3)+PV(3,2)*ST(1,3)*s(2)*s(3)+PV(3,2)*ST(3,1)*s(1)*s(2))*EQQQ(2,6,7)...
            + (PV(2,1)*ST(1,1)*s(3)^2+PV(2,3)*ST(1,3)*s(3)^2-PV(3,2)*ST(1,3)*s(2)^2-PV(2,2)*ST(2,1)*s(1)*s(2)-PV(3,2)*ST(3,1)*s(1)*s(3))*EQQQ(4,3,6)...
            + (PV(2,1)*ST(1,1)*s(1)*s(2)-PV(2,2)*ST(2,1)*s(3)^2+PV(2,3)*ST(1,3)*s(1)*s(2)+PV(3,2)*ST(1,3)*s(1)*s(2)+PV(3,2)*ST(3,1)*s(2)*s(3))*EQQQ(2,6,3)...
            + (PV(2,2)*ST(2,1)*s(2)*s(3)-PV(2,1)*ST(1,1)*s(1)*s(3)-PV(2,3)*ST(1,3)*s(1)*s(3)-PV(3,2)*ST(3,1)*s(2)^2-PV(3,2)*ST(1,3)*s(1)*s(3))*EQQQ(3,8,2);
        EvRvRPVGammat(1,3) = (PV(1,3)*ST(1,1)*s(2)^2+PV(1,3)*ST(1,1)*s(3)^2)*EQQQ(1,6,6)...
            + (-2*PV(1,3)*ST(1,1)*s(2)*s(3))*EQQQ(1,6,8)...
            + (PV(1,3)*ST(2,2)*s(2)^2+PV(1,3)*ST(2,2)*s(3)^2)*EQQQ(5,6,6)...
            + (-2*PV(1,3)*ST(2,2)*s(2)*s(3))*EQQQ(5,6,8)...
            + (-PV(1,1)*ST(3,1)*s(2)^2-PV(1,1)*ST(3,1)*s(3)^2-PV(1,2)*ST(3,2)*s(2)^2-PV(1,2)*ST(3,2)*s(3)^2)*EQQQ(9,6,6)...
            + (2*PV(1,1)*ST(3,1)*s(2)*s(3)+2*PV(1,2)*ST(3,2)*s(2)*s(3))*EQQQ(9,6,8)...
            + (PV(2,3)*ST(1,2)*s(2)*s(3)-PV(3,1)*ST(1,1)*s(2)*s(3)+PV(2,3)*ST(2,1)*s(1)*s(3)-PV(3,2)*ST(1,2)*s(2)*s(3)+PV(3,3)*ST(3,1)*s(1)*s(2))*EQQQ(2,6,7)...
            + (PV(3,1)*ST(1,1)*s(2)^2-PV(2,3)*ST(1,2)*s(3)^2+PV(3,2)*ST(1,2)*s(2)^2-PV(2,3)*ST(2,1)*s(1)*s(2)-PV(3,3)*ST(3,1)*s(1)*s(3))*EQQQ(4,3,6)...
            + (PV(3,3)*ST(3,1)*s(2)*s(3)-PV(2,3)*ST(1,2)*s(1)*s(2)-PV(3,1)*ST(1,1)*s(1)*s(2)-PV(3,2)*ST(1,2)*s(1)*s(2)-PV(2,3)*ST(2,1)*s(3)^2)*EQQQ(2,6,3)...
            + (PV(2,3)*ST(1,2)*s(1)*s(3)-PV(3,3)*ST(3,1)*s(2)^2+PV(3,1)*ST(1,1)*s(1)*s(3)+PV(3,2)*ST(1,2)*s(1)*s(3)+PV(2,3)*ST(2,1)*s(2)*s(3))*EQQQ(3,8,2);
        EvRvRPVGammat(2,1) = (-PV(2,2)*ST(1,2)*s(1)^2-PV(2,2)*ST(1,2)*s(3)^2-PV(2,3)*ST(1,3)*s(1)^2-PV(2,3)*ST(1,3)*s(3)^2)*EQQQ(1,3,3)...
            + (2*PV(2,2)*ST(1,2)*s(1)*s(3)+2*PV(2,3)*ST(1,3)*s(1)*s(3))*EQQQ(1,3,7)...
            + (PV(2,1)*ST(2,2)*s(1)^2+PV(2,1)*ST(2,2)*s(3)^2)*EQQQ(5,3,3)...
            + (-2*PV(2,1)*ST(2,2)*s(1)*s(3))*EQQQ(5,3,7)...
            + (PV(2,1)*ST(3,3)*s(1)^2+PV(2,1)*ST(3,3)*s(3)^2)*EQQQ(9,3,3)...
            + (-2*PV(2,1)*ST(3,3)*s(1)*s(3))*EQQQ(9,3,7)...
            + (PV(1,1)*ST(1,2)*s(2)*s(3)-PV(1,2)*ST(2,2)*s(1)*s(3)-PV(1,3)*ST(2,3)*s(1)*s(3)+PV(3,1)*ST(2,3)*s(1)*s(3)+PV(3,1)*ST(3,2)*s(1)*s(2))*EQQQ(2,6,7)...
            + (PV(1,2)*ST(2,2)*s(1)*s(2)-PV(1,1)*ST(1,2)*s(3)^2+PV(1,3)*ST(2,3)*s(1)*s(2)+PV(3,1)*ST(2,3)*s(1)*s(2)+PV(3,1)*ST(3,2)*s(1)*s(3))*EQQQ(4,3,6)...
            + (PV(1,2)*ST(2,2)*s(3)^2+PV(1,3)*ST(2,3)*s(3)^2-PV(3,1)*ST(2,3)*s(1)^2-PV(1,1)*ST(1,2)*s(1)*s(2)-PV(3,1)*ST(3,2)*s(2)*s(3))*EQQQ(2,6,3)...
            + (PV(1,1)*ST(1,2)*s(1)*s(3)-PV(3,1)*ST(3,2)*s(1)^2-PV(1,2)*ST(2,2)*s(2)*s(3)-PV(1,3)*ST(2,3)*s(2)*s(3)-PV(3,1)*ST(2,3)*s(2)*s(3))*EQQQ(3,8,2);
        EvRvRPVGammat(2,2) = (PV(2,2)*ST(1,1)*s(1)^2+PV(2,2)*ST(1,1)*s(3)^2)*EQQQ(1,3,3)...
            + (-2*PV(2,2)*ST(1,1)*s(1)*s(3))*EQQQ(1,3,7)...
            + (-PV(2,1)*ST(2,1)*s(1)^2-PV(2,1)*ST(2,1)*s(3)^2-PV(2,3)*ST(2,3)*s(1)^2-PV(2,3)*ST(2,3)*s(3)^2)*EQQQ(5,3,3)...
            + (2*PV(2,1)*ST(2,1)*s(1)*s(3)+2*PV(2,3)*ST(2,3)*s(1)*s(3))*EQQQ(5,3,7)...
            + (PV(2,2)*ST(3,3)*s(1)^2+PV(2,2)*ST(3,3)*s(3)^2)*EQQQ(9,3,3)...
            + (-2*PV(2,2)*ST(3,3)*s(1)*s(3))*EQQQ(9,3,7)...
            + (PV(1,2)*ST(2,1)*s(1)*s(3)-PV(1,3)*ST(1,3)*s(2)*s(3)-PV(1,1)*ST(1,1)*s(2)*s(3)+PV(3,2)*ST(2,3)*s(1)*s(3)-PV(3,1)*ST(3,1)*s(1)*s(2)-PV(3,3)*ST(3,3)*s(1)*s(2))*EQQQ(2,6,7)...
            + (PV(1,1)*ST(1,1)*s(3)^2+PV(1,3)*ST(1,3)*s(3)^2-PV(1,2)*ST(2,1)*s(1)*s(2)+PV(3,2)*ST(2,3)*s(1)*s(2)-PV(3,1)*ST(3,1)*s(1)*s(3)-PV(3,3)*ST(3,3)*s(1)*s(3))*EQQQ(4,3,6)...
            + (PV(1,1)*ST(1,1)*s(1)*s(2)-PV(3,2)*ST(2,3)*s(1)^2-PV(1,2)*ST(2,1)*s(3)^2+PV(1,3)*ST(1,3)*s(1)*s(2)+PV(3,1)*ST(3,1)*s(2)*s(3)+PV(3,3)*ST(3,3)*s(2)*s(3))*EQQQ(2,6,3)...
            + (PV(3,1)*ST(3,1)*s(1)^2+PV(3,3)*ST(3,3)*s(1)^2-PV(1,1)*ST(1,1)*s(1)*s(3)-PV(1,3)*ST(1,3)*s(1)*s(3)+PV(1,2)*ST(2,1)*s(2)*s(3)-PV(3,2)*ST(2,3)*s(2)*s(3))*EQQQ(3,8,2);
        EvRvRPVGammat(2,3) = (PV(2,3)*ST(1,1)*s(1)^2+PV(2,3)*ST(1,1)*s(3)^2)*EQQQ(1,3,3)...
            + (-2*PV(2,3)*ST(1,1)*s(1)*s(3))*EQQQ(1,3,7)...
            + (PV(2,3)*ST(2,2)*s(1)^2+PV(2,3)*ST(2,2)*s(3)^2)*EQQQ(5,3,3)...
            + (-2*PV(2,3)*ST(2,2)*s(1)*s(3))*EQQQ(5,3,7)...
            + (-PV(2,1)*ST(3,1)*s(1)^2-PV(2,1)*ST(3,1)*s(3)^2-PV(2,2)*ST(3,2)*s(1)^2-PV(2,2)*ST(3,2)*s(3)^2)*EQQQ(9,3,3)...
            + (2*PV(2,1)*ST(3,1)*s(1)*s(3)+2*PV(2,2)*ST(3,2)*s(1)*s(3))*EQQQ(9,3,7)...
            + (PV(1,3)*ST(1,2)*s(2)*s(3)+PV(1,3)*ST(2,1)*s(1)*s(3)-PV(3,1)*ST(2,1)*s(1)*s(3)-PV(3,2)*ST(2,2)*s(1)*s(3)+PV(3,3)*ST(3,2)*s(1)*s(2))*EQQQ(2,6,7)...
            + (PV(3,3)*ST(3,2)*s(1)*s(3)-PV(1,3)*ST(2,1)*s(1)*s(2)-PV(3,1)*ST(2,1)*s(1)*s(2)-PV(3,2)*ST(2,2)*s(1)*s(2)-PV(1,3)*ST(1,2)*s(3)^2)*EQQQ(4,3,6)...
            + (PV(3,1)*ST(2,1)*s(1)^2-PV(1,3)*ST(2,1)*s(3)^2+PV(3,2)*ST(2,2)*s(1)^2-PV(1,3)*ST(1,2)*s(1)*s(2)-PV(3,3)*ST(3,2)*s(2)*s(3))*EQQQ(2,6,3)...
            + (PV(1,3)*ST(1,2)*s(1)*s(3)-PV(3,3)*ST(3,2)*s(1)^2+PV(1,3)*ST(2,1)*s(2)*s(3)+PV(3,1)*ST(2,1)*s(2)*s(3)+PV(3,2)*ST(2,2)*s(2)*s(3))*EQQQ(3,8,2);
        EvRvRPVGammat(3,1) = (-PV(3,2)*ST(1,2)*s(1)^2-PV(3,2)*ST(1,2)*s(2)^2-PV(3,3)*ST(1,3)*s(1)^2-PV(3,3)*ST(1,3)*s(2)^2)*EQQQ(1,2,2)...
            + (2*PV(3,2)*ST(1,2)*s(1)*s(2)+2*PV(3,3)*ST(1,3)*s(1)*s(2))*EQQQ(1,2,4)...
            + (PV(3,1)*ST(2,2)*s(1)^2+PV(3,1)*ST(2,2)*s(2)^2)*EQQQ(5,2,2)...
            + (-2*PV(3,1)*ST(2,2)*s(1)*s(2))*EQQQ(5,2,4)...
            + (PV(3,1)*ST(3,3)*s(1)^2+PV(3,1)*ST(3,3)*s(2)^2)*EQQQ(9,2,2)...
            + (-2*PV(3,1)*ST(3,3)*s(1)*s(2))*EQQQ(9,2,4)...
            + (PV(1,1)*ST(1,3)*s(2)*s(3)-PV(1,2)*ST(3,2)*s(1)*s(2)+PV(2,1)*ST(2,3)*s(1)*s(3)-PV(1,3)*ST(3,3)*s(1)*s(2)+PV(2,1)*ST(3,2)*s(1)*s(2))*EQQQ(2,6,7)...
            + (PV(2,1)*ST(2,3)*s(1)*s(2)-PV(1,1)*ST(1,3)*s(2)^2+PV(1,2)*ST(3,2)*s(1)*s(3)+PV(1,3)*ST(3,3)*s(1)*s(3)+PV(2,1)*ST(3,2)*s(1)*s(3))*EQQQ(4,3,6)...
            + (PV(1,1)*ST(1,3)*s(1)*s(2)-PV(2,1)*ST(2,3)*s(1)^2-PV(1,2)*ST(3,2)*s(2)*s(3)-PV(1,3)*ST(3,3)*s(2)*s(3)-PV(2,1)*ST(3,2)*s(2)*s(3))*EQQQ(2,6,3)...
            + (PV(1,2)*ST(3,2)*s(2)^2+PV(1,3)*ST(3,3)*s(2)^2-PV(2,1)*ST(3,2)*s(1)^2-PV(1,1)*ST(1,3)*s(1)*s(3)-PV(2,1)*ST(2,3)*s(2)*s(3))*EQQQ(3,8,2);
        EvRvRPVGammat(3,2) = (PV(3,2)*ST(1,1)*s(1)^2+PV(3,2)*ST(1,1)*s(2)^2)*EQQQ(1,2,2)...
            + (-2*PV(3,2)*ST(1,1)*s(1)*s(2))*EQQQ(1,2,4)...
            + (-PV(3,1)*ST(2,1)*s(1)^2-PV(3,1)*ST(2,1)*s(2)^2-PV(3,3)*ST(2,3)*s(1)^2-PV(3,3)*ST(2,3)*s(2)^2)*EQQQ(5,2,2)...
            + (2*PV(3,1)*ST(2,1)*s(1)*s(2)+2*PV(3,3)*ST(2,3)*s(1)*s(2))*EQQQ(5,2,4)...
            + (PV(3,2)*ST(3,3)*s(1)^2+PV(3,2)*ST(3,3)*s(2)^2)*EQQQ(9,2,2)...
            + (-2*PV(3,2)*ST(3,3)*s(1)*s(2))*EQQQ(9,2,4)...
            + (PV(1,2)*ST(1,3)*s(2)*s(3)+PV(1,2)*ST(3,1)*s(1)*s(2)+PV(2,2)*ST(2,3)*s(1)*s(3)-PV(2,1)*ST(3,1)*s(1)*s(2)-PV(2,3)*ST(3,3)*s(1)*s(2))*EQQQ(2,6,7)...
            + (PV(2,2)*ST(2,3)*s(1)*s(2)-PV(1,2)*ST(3,1)*s(1)*s(3)-PV(1,2)*ST(1,3)*s(2)^2-PV(2,1)*ST(3,1)*s(1)*s(3)-PV(2,3)*ST(3,3)*s(1)*s(3))*EQQQ(4,3,6)...
            + (PV(1,2)*ST(1,3)*s(1)*s(2)-PV(2,2)*ST(2,3)*s(1)^2+PV(1,2)*ST(3,1)*s(2)*s(3)+PV(2,1)*ST(3,1)*s(2)*s(3)+PV(2,3)*ST(3,3)*s(2)*s(3))*EQQQ(2,6,3)...
            + (PV(2,1)*ST(3,1)*s(1)^2-PV(1,2)*ST(3,1)*s(2)^2+PV(2,3)*ST(3,3)*s(1)^2-PV(1,2)*ST(1,3)*s(1)*s(3)-PV(2,2)*ST(2,3)*s(2)*s(3))*EQQQ(3,8,2);
        EvRvRPVGammat(3,3) = (PV(3,3)*ST(1,1)*s(1)^2+PV(3,3)*ST(1,1)*s(2)^2)*EQQQ(1,2,2)...
            + (-2*PV(3,3)*ST(1,1)*s(1)*s(2))*EQQQ(1,2,4)...
            + (PV(3,3)*ST(2,2)*s(1)^2+PV(3,3)*ST(2,2)*s(2)^2)*EQQQ(5,2,2)...
            + (-2*PV(3,3)*ST(2,2)*s(1)*s(2))*EQQQ(5,2,4)...
            + (-PV(3,1)*ST(3,1)*s(1)^2-PV(3,1)*ST(3,1)*s(2)^2-PV(3,2)*ST(3,2)*s(1)^2-PV(3,2)*ST(3,2)*s(2)^2)*EQQQ(9,2,2)...
            + (2*PV(3,1)*ST(3,1)*s(1)*s(2)+2*PV(3,2)*ST(3,2)*s(1)*s(2))*EQQQ(9,2,4)...
            + (PV(1,3)*ST(3,1)*s(1)*s(2)-PV(1,2)*ST(1,2)*s(2)*s(3)-PV(2,1)*ST(2,1)*s(1)*s(3)-PV(1,1)*ST(1,1)*s(2)*s(3)-PV(2,2)*ST(2,2)*s(1)*s(3)+PV(2,3)*ST(3,2)*s(1)*s(2))*EQQQ(2,6,7)...
            + (PV(1,1)*ST(1,1)*s(2)^2+PV(1,2)*ST(1,2)*s(2)^2-PV(2,1)*ST(2,1)*s(1)*s(2)-PV(2,2)*ST(2,2)*s(1)*s(2)-PV(1,3)*ST(3,1)*s(1)*s(3)+PV(2,3)*ST(3,2)*s(1)*s(3))*EQQQ(4,3,6)...
            + (PV(2,1)*ST(2,1)*s(1)^2+PV(2,2)*ST(2,2)*s(1)^2-PV(1,1)*ST(1,1)*s(1)*s(2)-PV(1,2)*ST(1,2)*s(1)*s(2)+PV(1,3)*ST(3,1)*s(2)*s(3)-PV(2,3)*ST(3,2)*s(2)*s(3))*EQQQ(2,6,3)...
            + (PV(1,1)*ST(1,1)*s(1)*s(3)-PV(2,3)*ST(3,2)*s(1)^2-PV(1,3)*ST(3,1)*s(2)^2+PV(1,2)*ST(1,2)*s(1)*s(3)+PV(2,1)*ST(2,1)*s(2)*s(3)+PV(2,2)*ST(2,2)*s(2)*s(3))*EQQQ(3,8,2);
        
        ExvRhatxwpt = dt*(Sigmac*V*EGammat'+Miu*EvRPVGammat+P*EvRvRPVGammat)*VT';
    end
else
    PU = P'*U;
    if defQS
        EGammat = [ST(2,2)*EQ(2,2)+ST(3,3)*EQ(3,3), -ST(2,1)*EQ(1,1), -ST(3,1)*EQ(1,1);
            -ST(1,2)*EQ(2,2), ST(1,1)*EQ(1,1)+ST(3,3)*EQ(3,3), -ST(3,2)*EQ(2,2);
            -ST(1,3)*EQ(3,3), -ST(2,3)*EQ(3,3), ST(1,1)*EQ(1,1)+ST(2,2)*EQ(2,2)];
        
        EvRPUGammat(1) = (PU(3,1)*ST(2,1)-PU(2,1)*ST(3,1))*EQ(1,1)...
            + (PU(3,2)*ST(2,2)+PU(3,3)*ST(3,2)+PU(1,1)*ST(3,2))*EQ(2,2)...
            - (PU(2,2)*ST(2,3)+PU(2,3)*ST(3,3)+PU(1,1)*ST(2,3))*EQ(3,3);
        EvRPUGammat(2) = (PU(1,2)*ST(3,2)-PU(3,2)*ST(1,2))*EQ(2,2)...
            - (PU(3,1)*ST(1,1)+PU(3,3)*ST(3,1)+PU(2,2)*ST(3,1))*EQ(1,1)...
            + (PU(1,1)*ST(1,3)+PU(1,3)*ST(3,3)+PU(2,2)*ST(1,3))*EQ(3,3);
        EvRPUGammat(3) = (PU(2,3)*ST(1,3)-PU(1,3)*ST(2,3))*EQ(3,3)...
            + (PU(2,1)*ST(1,1)+PU(2,2)*ST(2,1)+PU(3,3)*ST(2,1))*EQ(1,1)...
            - (PU(1,1)*ST(1,2)+PU(1,2)*ST(2,2)+PU(3,3)*ST(1,2))*EQ(2,2);
        
        EvRvRPUGammat(1,1) = (-PU(1,2)*ST(2,1)*s(2)^2-PU(1,2)*ST(2,1)*s(3)^2-PU(1,3)*ST(3,1)*s(2)^2-PU(1,3)*ST(3,1)*s(3)^2)*EQQQ(1,6,6)...
            + (2*PU(1,2)*ST(2,1)*s(2)*s(3)+2*PU(1,3)*ST(3,1)*s(2)*s(3))*EQQQ(1,6,8)...
            + (PU(1,1)*ST(2,2)*s(2)^2+PU(1,1)*ST(2,2)*s(3)^2)*EQQQ(5,6,6)...
            + (-2*PU(1,1)*ST(2,2)*s(2)*s(3))*EQQQ(5,6,8)...
            + (PU(1,1)*ST(3,3)*s(2)^2+PU(1,1)*ST(3,3)*s(3)^2)*EQQQ(9,6,6)...
            + (-2*PU(1,1)*ST(3,3)*s(2)*s(3))*EQQQ(9,6,8)...
            + (PU(2,1)*ST(2,1)*s(2)*s(3)-PU(2,2)*ST(2,2)*s(1)*s(3)-PU(3,2)*ST(2,3)*s(1)*s(2)-PU(2,3)*ST(3,2)*s(1)*s(3)+PU(3,1)*ST(3,1)*s(2)*s(3)-PU(3,3)*ST(3,3)*s(1)*s(2))*EQQQ(2,6,7)...
            + (PU(2,2)*ST(2,2)*s(1)*s(2)-PU(3,1)*ST(3,1)*s(2)^2-PU(2,1)*ST(2,1)*s(3)^2+PU(2,3)*ST(3,2)*s(1)*s(2)+PU(3,2)*ST(2,3)*s(1)*s(3)+PU(3,3)*ST(3,3)*s(1)*s(3))*EQQQ(4,3,6)...
            + (PU(2,2)*ST(2,2)*s(3)^2+PU(2,3)*ST(3,2)*s(3)^2-PU(2,1)*ST(2,1)*s(1)*s(2)-PU(3,2)*ST(2,3)*s(2)*s(3)+PU(3,1)*ST(3,1)*s(1)*s(2)-PU(3,3)*ST(3,3)*s(2)*s(3))*EQQQ(2,6,3)...
            + (PU(3,2)*ST(2,3)*s(2)^2+PU(3,3)*ST(3,3)*s(2)^2+PU(2,1)*ST(2,1)*s(1)*s(3)-PU(2,2)*ST(2,2)*s(2)*s(3)-PU(2,3)*ST(3,2)*s(2)*s(3)-PU(3,1)*ST(3,1)*s(1)*s(3))*EQQQ(3,8,2);
        EvRvRPUGammat(1,2) = (PU(1,2)*ST(1,1)*s(2)^2+PU(1,2)*ST(1,1)*s(3)^2)*EQQQ(1,6,6)...
            + (-2*PU(1,2)*ST(1,1)*s(2)*s(3))*EQQQ(1,6,8)...
            + (-PU(1,1)*ST(1,2)*s(2)^2-PU(1,1)*ST(1,2)*s(3)^2-PU(1,3)*ST(3,2)*s(2)^2-PU(1,3)*ST(3,2)*s(3)^2)*EQQQ(5,6,6)...
            + (2*PU(1,1)*ST(1,2)*s(2)*s(3)+2*PU(1,3)*ST(3,2)*s(2)*s(3))*EQQQ(5,6,8)...
            + (PU(1,2)*ST(3,3)*s(2)^2+PU(1,2)*ST(3,3)*s(3)^2)*EQQQ(9,6,6)...
            + (-2*PU(1,2)*ST(3,3)*s(2)*s(3))*EQQQ(9,6,8)...
            + (PU(2,2)*ST(1,2)*s(1)*s(3)-PU(2,1)*ST(1,1)*s(2)*s(3)+PU(3,2)*ST(1,3)*s(1)*s(2)-PU(2,3)*ST(3,1)*s(2)*s(3)+PU(3,2)*ST(3,1)*s(2)*s(3))*EQQQ(2,6,7)...
            + (PU(2,1)*ST(1,1)*s(3)^2+PU(2,3)*ST(3,1)*s(3)^2-PU(3,2)*ST(3,1)*s(2)^2-PU(2,2)*ST(1,2)*s(1)*s(2)-PU(3,2)*ST(1,3)*s(1)*s(3))*EQQQ(4,3,6)...
            + (PU(2,1)*ST(1,1)*s(1)*s(2)-PU(2,2)*ST(1,2)*s(3)^2+PU(3,2)*ST(1,3)*s(2)*s(3)+PU(2,3)*ST(3,1)*s(1)*s(2)+PU(3,2)*ST(3,1)*s(1)*s(2))*EQQQ(2,6,3)...
            + (PU(2,2)*ST(1,2)*s(2)*s(3)-PU(2,1)*ST(1,1)*s(1)*s(3)-PU(3,2)*ST(1,3)*s(2)^2-PU(2,3)*ST(3,1)*s(1)*s(3)-PU(3,2)*ST(3,1)*s(1)*s(3))*EQQQ(3,8,2);
        EvRvRPUGammat(1,3) = (PU(1,3)*ST(1,1)*s(2)^2+PU(1,3)*ST(1,1)*s(3)^2)*EQQQ(1,6,6)...
            + (-2*PU(1,3)*ST(1,1)*s(2)*s(3))*EQQQ(1,6,8)...
            + (PU(1,3)*ST(2,2)*s(2)^2+PU(1,3)*ST(2,2)*s(3)^2)*EQQQ(5,6,6)...
            + (-2*PU(1,3)*ST(2,2)*s(2)*s(3))*EQQQ(5,6,8)...
            + (-PU(1,1)*ST(1,3)*s(2)^2-PU(1,1)*ST(1,3)*s(3)^2-PU(1,2)*ST(2,3)*s(2)^2-PU(1,2)*ST(2,3)*s(3)^2)*EQQQ(9,6,6)...
            + (2*PU(1,1)*ST(1,3)*s(2)*s(3)+2*PU(1,2)*ST(2,3)*s(2)*s(3))*EQQQ(9,6,8)...
            + (PU(2,3)*ST(1,2)*s(1)*s(3)-PU(3,1)*ST(1,1)*s(2)*s(3)+PU(2,3)*ST(2,1)*s(2)*s(3)+PU(3,3)*ST(1,3)*s(1)*s(2)-PU(3,2)*ST(2,1)*s(2)*s(3))*EQQQ(2,6,7)...
            + (PU(3,1)*ST(1,1)*s(2)^2-PU(2,3)*ST(2,1)*s(3)^2+PU(3,2)*ST(2,1)*s(2)^2-PU(2,3)*ST(1,2)*s(1)*s(2)-PU(3,3)*ST(1,3)*s(1)*s(3))*EQQQ(4,3,6)...
            + (PU(3,3)*ST(1,3)*s(2)*s(3)-PU(3,1)*ST(1,1)*s(1)*s(2)-PU(2,3)*ST(2,1)*s(1)*s(2)-PU(2,3)*ST(1,2)*s(3)^2-PU(3,2)*ST(2,1)*s(1)*s(2))*EQQQ(2,6,3)...
            + (PU(2,3)*ST(1,2)*s(2)*s(3)-PU(3,3)*ST(1,3)*s(2)^2+PU(3,1)*ST(1,1)*s(1)*s(3)+PU(2,3)*ST(2,1)*s(1)*s(3)+PU(3,2)*ST(2,1)*s(1)*s(3))*EQQQ(3,8,2);
        EvRvRPUGammat(2,1) = (-PU(2,2)*ST(2,1)*s(1)^2-PU(2,2)*ST(2,1)*s(3)^2-PU(2,3)*ST(3,1)*s(1)^2-PU(2,3)*ST(3,1)*s(3)^2)*EQQQ(1,3,3)...
            + (2*PU(2,2)*ST(2,1)*s(1)*s(3)+2*PU(2,3)*ST(3,1)*s(1)*s(3))*EQQQ(1,3,7)...
            + (PU(2,1)*ST(2,2)*s(1)^2+PU(2,1)*ST(2,2)*s(3)^2)*EQQQ(5,3,3)...
            + (-2*PU(2,1)*ST(2,2)*s(1)*s(3))*EQQQ(5,3,7)...
            + (PU(2,1)*ST(3,3)*s(1)^2+PU(2,1)*ST(3,3)*s(3)^2)*EQQQ(9,3,3)...
            + (-2*PU(2,1)*ST(3,3)*s(1)*s(3))*EQQQ(9,3,7)...
            + (PU(1,1)*ST(2,1)*s(2)*s(3)-PU(1,2)*ST(2,2)*s(1)*s(3)-PU(1,3)*ST(3,2)*s(1)*s(3)+PU(3,1)*ST(2,3)*s(1)*s(2)+PU(3,1)*ST(3,2)*s(1)*s(3))*EQQQ(2,6,7)...
            + (PU(1,2)*ST(2,2)*s(1)*s(2)-PU(1,1)*ST(2,1)*s(3)^2+PU(1,3)*ST(3,2)*s(1)*s(2)+PU(3,1)*ST(2,3)*s(1)*s(3)+PU(3,1)*ST(3,2)*s(1)*s(2))*EQQQ(4,3,6)...
            + (PU(1,2)*ST(2,2)*s(3)^2+PU(1,3)*ST(3,2)*s(3)^2-PU(3,1)*ST(3,2)*s(1)^2-PU(1,1)*ST(2,1)*s(1)*s(2)-PU(3,1)*ST(2,3)*s(2)*s(3))*EQQQ(2,6,3)...
            + (PU(1,1)*ST(2,1)*s(1)*s(3)-PU(3,1)*ST(2,3)*s(1)^2-PU(1,2)*ST(2,2)*s(2)*s(3)-PU(1,3)*ST(3,2)*s(2)*s(3)-PU(3,1)*ST(3,2)*s(2)*s(3))*EQQQ(3,8,2);
        EvRvRPUGammat(2,2) = (PU(2,2)*ST(1,1)*s(1)^2+PU(2,2)*ST(1,1)*s(3)^2)*EQQQ(1,3,3)...
            + (-2*PU(2,2)*ST(1,1)*s(1)*s(3))*EQQQ(1,3,7)...
            + (-PU(2,1)*ST(1,2)*s(1)^2-PU(2,1)*ST(1,2)*s(3)^2-PU(2,3)*ST(3,2)*s(1)^2-PU(2,3)*ST(3,2)*s(3)^2)*EQQQ(5,3,3)...
            + (2*PU(2,1)*ST(1,2)*s(1)*s(3)+2*PU(2,3)*ST(3,2)*s(1)*s(3))*EQQQ(5,3,7)...
            + (PU(2,2)*ST(3,3)*s(1)^2+PU(2,2)*ST(3,3)*s(3)^2)*EQQQ(9,3,3)...
            + (-2*PU(2,2)*ST(3,3)*s(1)*s(3))*EQQQ(9,3,7)...
            + (PU(1,2)*ST(1,2)*s(1)*s(3)-PU(1,1)*ST(1,1)*s(2)*s(3)-PU(3,1)*ST(1,3)*s(1)*s(2)-PU(1,3)*ST(3,1)*s(2)*s(3)+PU(3,2)*ST(3,2)*s(1)*s(3)-PU(3,3)*ST(3,3)*s(1)*s(2))*EQQQ(2,6,7)...
            + (PU(1,1)*ST(1,1)*s(3)^2+PU(1,3)*ST(3,1)*s(3)^2-PU(1,2)*ST(1,2)*s(1)*s(2)-PU(3,1)*ST(1,3)*s(1)*s(3)+PU(3,2)*ST(3,2)*s(1)*s(2)-PU(3,3)*ST(3,3)*s(1)*s(3))*EQQQ(4,3,6)...
            + (PU(1,1)*ST(1,1)*s(1)*s(2)-PU(3,2)*ST(3,2)*s(1)^2-PU(1,2)*ST(1,2)*s(3)^2+PU(1,3)*ST(3,1)*s(1)*s(2)+PU(3,1)*ST(1,3)*s(2)*s(3)+PU(3,3)*ST(3,3)*s(2)*s(3))*EQQQ(2,6,3)...
            + (PU(3,1)*ST(1,3)*s(1)^2+PU(3,3)*ST(3,3)*s(1)^2-PU(1,1)*ST(1,1)*s(1)*s(3)+PU(1,2)*ST(1,2)*s(2)*s(3)-PU(1,3)*ST(3,1)*s(1)*s(3)-PU(3,2)*ST(3,2)*s(2)*s(3))*EQQQ(3,8,2);
        EvRvRPUGammat(2,3) = (PU(2,3)*ST(1,1)*s(1)^2+PU(2,3)*ST(1,1)*s(3)^2)*EQQQ(1,3,3)...
            + (-2*PU(2,3)*ST(1,1)*s(1)*s(3))*EQQQ(1,3,7)...
            + (PU(2,3)*ST(2,2)*s(1)^2+PU(2,3)*ST(2,2)*s(3)^2)*EQQQ(5,3,3)...
            + (-2*PU(2,3)*ST(2,2)*s(1)*s(3))*EQQQ(5,3,7)...
            + (-PU(2,1)*ST(1,3)*s(1)^2-PU(2,1)*ST(1,3)*s(3)^2-PU(2,2)*ST(2,3)*s(1)^2-PU(2,2)*ST(2,3)*s(3)^2)*EQQQ(9,3,3)...
            + (2*PU(2,1)*ST(1,3)*s(1)*s(3)+2*PU(2,2)*ST(2,3)*s(1)*s(3))*EQQQ(9,3,7)...
            + (PU(1,3)*ST(1,2)*s(1)*s(3)+PU(1,3)*ST(2,1)*s(2)*s(3)-PU(3,1)*ST(1,2)*s(1)*s(3)-PU(3,2)*ST(2,2)*s(1)*s(3)+PU(3,3)*ST(2,3)*s(1)*s(2))*EQQQ(2,6,7)...
            + (PU(3,3)*ST(2,3)*s(1)*s(3)-PU(1,3)*ST(1,2)*s(1)*s(2)-PU(3,1)*ST(1,2)*s(1)*s(2)-PU(3,2)*ST(2,2)*s(1)*s(2)-PU(1,3)*ST(2,1)*s(3)^2)*EQQQ(4,3,6)...
            + (PU(3,1)*ST(1,2)*s(1)^2-PU(1,3)*ST(1,2)*s(3)^2+PU(3,2)*ST(2,2)*s(1)^2-PU(1,3)*ST(2,1)*s(1)*s(2)-PU(3,3)*ST(2,3)*s(2)*s(3))*EQQQ(2,6,3)...
            + (PU(1,3)*ST(1,2)*s(2)*s(3)-PU(3,3)*ST(2,3)*s(1)^2+PU(1,3)*ST(2,1)*s(1)*s(3)+PU(3,1)*ST(1,2)*s(2)*s(3)+PU(3,2)*ST(2,2)*s(2)*s(3))*EQQQ(3,8,2);
        EvRvRPUGammat(3,1) = (-PU(3,2)*ST(2,1)*s(1)^2-PU(3,2)*ST(2,1)*s(2)^2-PU(3,3)*ST(3,1)*s(1)^2-PU(3,3)*ST(3,1)*s(2)^2)*EQQQ(1,2,2)...
            + (2*PU(3,2)*ST(2,1)*s(1)*s(2)+2*PU(3,3)*ST(3,1)*s(1)*s(2))*EQQQ(1,2,4)...
            + (PU(3,1)*ST(2,2)*s(1)^2+PU(3,1)*ST(2,2)*s(2)^2)*EQQQ(5,2,2)...
            + (-2*PU(3,1)*ST(2,2)*s(1)*s(2))*EQQQ(5,2,4)...
            + (PU(3,1)*ST(3,3)*s(1)^2+PU(3,1)*ST(3,3)*s(2)^2)*EQQQ(9,2,2)...
            + (-2*PU(3,1)*ST(3,3)*s(1)*s(2))*EQQQ(9,2,4)...
            + (PU(1,1)*ST(3,1)*s(2)*s(3)-PU(1,2)*ST(2,3)*s(1)*s(2)+PU(2,1)*ST(2,3)*s(1)*s(2)-PU(1,3)*ST(3,3)*s(1)*s(2)+PU(2,1)*ST(3,2)*s(1)*s(3))*EQQQ(2,6,7)...
            + (PU(1,2)*ST(2,3)*s(1)*s(3)-PU(1,1)*ST(3,1)*s(2)^2+PU(2,1)*ST(2,3)*s(1)*s(3)+PU(1,3)*ST(3,3)*s(1)*s(3)+PU(2,1)*ST(3,2)*s(1)*s(2))*EQQQ(4,3,6)...
            + (PU(1,1)*ST(3,1)*s(1)*s(2)-PU(1,2)*ST(2,3)*s(2)*s(3)-PU(2,1)*ST(3,2)*s(1)^2-PU(2,1)*ST(2,3)*s(2)*s(3)-PU(1,3)*ST(3,3)*s(2)*s(3))*EQQQ(2,6,3)...
            + (PU(1,2)*ST(2,3)*s(2)^2-PU(2,1)*ST(2,3)*s(1)^2+PU(1,3)*ST(3,3)*s(2)^2-PU(1,1)*ST(3,1)*s(1)*s(3)-PU(2,1)*ST(3,2)*s(2)*s(3))*EQQQ(3,8,2);
        EvRvRPUGammat(3,2) = (PU(3,2)*ST(1,1)*s(1)^2+PU(3,2)*ST(1,1)*s(2)^2)*EQQQ(1,2,2)...
            + (-2*PU(3,2)*ST(1,1)*s(1)*s(2))*EQQQ(1,2,4)...
            + (-PU(3,1)*ST(1,2)*s(1)^2-PU(3,1)*ST(1,2)*s(2)^2-PU(3,3)*ST(3,2)*s(1)^2-PU(3,3)*ST(3,2)*s(2)^2)*EQQQ(5,2,2)...
            + (2*PU(3,1)*ST(1,2)*s(1)*s(2)+2*PU(3,3)*ST(3,2)*s(1)*s(2))*EQQQ(5,2,4)...
            + (PU(3,2)*ST(3,3)*s(1)^2+PU(3,2)*ST(3,3)*s(2)^2)*EQQQ(9,2,2)...
            + (-2*PU(3,2)*ST(3,3)*s(1)*s(2))*EQQQ(9,2,4)...
            + (PU(1,2)*ST(1,3)*s(1)*s(2)-PU(2,1)*ST(1,3)*s(1)*s(2)+PU(1,2)*ST(3,1)*s(2)*s(3)+PU(2,2)*ST(3,2)*s(1)*s(3)-PU(2,3)*ST(3,3)*s(1)*s(2))*EQQQ(2,6,7)...
            + (PU(2,2)*ST(3,2)*s(1)*s(2)-PU(1,2)*ST(1,3)*s(1)*s(3)-PU(2,1)*ST(1,3)*s(1)*s(3)-PU(1,2)*ST(3,1)*s(2)^2-PU(2,3)*ST(3,3)*s(1)*s(3))*EQQQ(4,3,6)...
            + (PU(1,2)*ST(1,3)*s(2)*s(3)-PU(2,2)*ST(3,2)*s(1)^2+PU(2,1)*ST(1,3)*s(2)*s(3)+PU(1,2)*ST(3,1)*s(1)*s(2)+PU(2,3)*ST(3,3)*s(2)*s(3))*EQQQ(2,6,3)...
            + (PU(2,1)*ST(1,3)*s(1)^2-PU(1,2)*ST(1,3)*s(2)^2+PU(2,3)*ST(3,3)*s(1)^2-PU(1,2)*ST(3,1)*s(1)*s(3)-PU(2,2)*ST(3,2)*s(2)*s(3))*EQQQ(3,8,2);
        EvRvRPUGammat(3,3) = (PU(3,3)*ST(1,1)*s(1)^2+PU(3,3)*ST(1,1)*s(2)^2)*EQQQ(1,2,2)...
            + (-2*PU(3,3)*ST(1,1)*s(1)*s(2))*EQQQ(1,2,4)...
            + (PU(3,3)*ST(2,2)*s(1)^2+PU(3,3)*ST(2,2)*s(2)^2)*EQQQ(5,2,2)...
            + (-2*PU(3,3)*ST(2,2)*s(1)*s(2))*EQQQ(5,2,4)...
            + (-PU(3,1)*ST(1,3)*s(1)^2-PU(3,1)*ST(1,3)*s(2)^2-PU(3,2)*ST(2,3)*s(1)^2-PU(3,2)*ST(2,3)*s(2)^2)*EQQQ(9,2,2)...
            + (2*PU(3,1)*ST(1,3)*s(1)*s(2)+2*PU(3,2)*ST(2,3)*s(1)*s(2))*EQQQ(9,2,4)...
            + (PU(1,3)*ST(1,3)*s(1)*s(2)-PU(1,1)*ST(1,1)*s(2)*s(3)-PU(2,1)*ST(1,2)*s(1)*s(3)-PU(1,2)*ST(2,1)*s(2)*s(3)-PU(2,2)*ST(2,2)*s(1)*s(3)+PU(2,3)*ST(2,3)*s(1)*s(2))*EQQQ(2,6,7)...
            + (PU(1,1)*ST(1,1)*s(2)^2+PU(1,2)*ST(2,1)*s(2)^2-PU(1,3)*ST(1,3)*s(1)*s(3)-PU(2,1)*ST(1,2)*s(1)*s(2)-PU(2,2)*ST(2,2)*s(1)*s(2)+PU(2,3)*ST(2,3)*s(1)*s(3))*EQQQ(4,3,6)...
            + (PU(2,1)*ST(1,2)*s(1)^2+PU(2,2)*ST(2,2)*s(1)^2-PU(1,1)*ST(1,1)*s(1)*s(2)+PU(1,3)*ST(1,3)*s(2)*s(3)-PU(1,2)*ST(2,1)*s(1)*s(2)-PU(2,3)*ST(2,3)*s(2)*s(3))*EQQQ(2,6,3)...
            + (PU(1,1)*ST(1,1)*s(1)*s(3)-PU(2,3)*ST(2,3)*s(1)^2-PU(1,3)*ST(1,3)*s(2)^2+PU(1,2)*ST(2,1)*s(1)*s(3)+PU(2,1)*ST(1,2)*s(2)*s(3)+PU(2,2)*ST(2,2)*s(2)*s(3))*EQQQ(3,8,2);
        
        ExvRhatxwpt = dt*(Sigmac*U*EGammat'+Miu*EvRPUGammat+P*EvRvRPUGammat)*UT';
    else
        EGammat = [ST(2,2)*EQ(3,3)+ST(3,3)*EQ(2,2), -ST(1,2)*EQ(3,3), -ST(1,3)*EQ(2,2);
            -ST(2,1)*EQ(3,3), ST(1,1)*EQ(3,3)+ST(3,3)*EQ(1,1), -ST(2,3)*EQ(1,1);
            -ST(3,1)*EQ(2,2), -ST(3,2)*EQ(1,1), ST(1,1)*EQ(2,2)+ST(2,2)*EQ(1,1)];
        
        EvRPUGammat(1) = (PU(3,2)*ST(3,3)-PU(3,3)*ST(2,3)+PU(2,2)*ST(3,2)-PU(2,3)*ST(2,2))*EQ(1,1)...
            + (PU(1,1)*ST(3,2)-PU(1,3)*ST(1,2))*EQ(2,2)+(PU(1,2)*ST(1,3)-PU(1,1)*ST(2,3))*EQ(3,3);
        EvRPUGammat(2) = (PU(3,3)*ST(1,3)-PU(3,1)*ST(3,3)+PU(1,3)*ST(1,1)-PU(1,1)*ST(3,1))*EQ(2,2)...
            + (PU(2,3)*ST(2,1)-PU(2,2)*ST(3,1))*EQ(1,1)+(PU(2,2)*ST(1,3)-PU(2,1)*ST(2,3))*EQ(3,3);
        EvRPUGammat(3) = (PU(2,1)*ST(2,2)-PU(2,2)*ST(2,1)+PU(1,1)*ST(2,1)-PU(1,2)*ST(1,1))*EQ(3,3)...
            + (PU(3,3)*ST(2,1)-PU(3,2)*ST(3,1))*EQ(1,1)+(PU(3,1)*ST(3,2)-PU(3,3)*ST(1,2))*EQ(2,2);
        
        EvRvRPUGammat(1,1) = (PU(1,1)*ST(3,3)*s(2)^2-PU(1,3)*ST(1,3)*s(3)^2-PU(1,3)*ST(1,3)*s(2)^2+PU(1,1)*ST(3,3)*s(3)^2)*EQQQ(5,6,6)...
            + (2*PU(1,3)*ST(1,3)*s(2)*s(3)-2*PU(1,1)*ST(3,3)*s(2)*s(3))*EQQQ(5,6,8)...
            + (PU(1,1)*ST(2,2)*s(2)^2-PU(1,2)*ST(1,2)*s(3)^2-PU(1,2)*ST(1,2)*s(2)^2+PU(1,1)*ST(2,2)*s(3)^2)*EQQQ(9,6,6)...
            + (2*PU(1,2)*ST(1,2)*s(2)*s(3)-2*PU(1,1)*ST(2,2)*s(2)*s(3))*EQQQ(9,6,8)...
            + (PU(2,3)*ST(2,3)*s(2)*s(3)-PU(2,2)*ST(3,3)*s(2)*s(3)-PU(3,3)*ST(2,2)*s(2)*s(3)+PU(3,2)*ST(3,2)*s(2)*s(3))*EQQQ(2,6,7)...
            + (PU(3,3)*ST(2,2)*s(2)^2-PU(2,3)*ST(2,3)*s(3)^2+PU(2,2)*ST(3,3)*s(3)^2-PU(3,2)*ST(3,2)*s(2)^2)*EQQQ(4,3,6)...
            + (PU(2,2)*ST(3,3)*s(1)*s(2)-PU(2,3)*ST(2,3)*s(1)*s(2)-PU(3,3)*ST(2,2)*s(1)*s(2)+PU(3,2)*ST(3,2)*s(1)*s(2))*EQQQ(2,6,3)...
            + (PU(2,3)*ST(2,3)*s(1)*s(3)-PU(2,2)*ST(3,3)*s(1)*s(3)+PU(3,3)*ST(2,2)*s(1)*s(3)-PU(3,2)*ST(3,2)*s(1)*s(3))*EQQQ(3,8,2);
        EvRvRPUGammat(1,2) = (PU(1,2)*ST(3,3)*s(2)^2-PU(1,3)*ST(2,3)*s(3)^2-PU(1,3)*ST(2,3)*s(2)^2+PU(1,2)*ST(3,3)*s(3)^2)*EQQQ(1,6,6)...
            + (2*PU(1,3)*ST(2,3)*s(2)*s(3)-2*PU(1,2)*ST(3,3)*s(2)*s(3))*EQQQ(1,6,8)...
            + (PU(1,2)*ST(1,1)*s(2)^2+PU(1,2)*ST(1,1)*s(3)^2-PU(1,1)*ST(2,1)*s(2)^2-PU(1,1)*ST(2,1)*s(3)^2)*EQQQ(9,6,6)...
            + (2*PU(1,1)*ST(2,1)*s(2)*s(3)-2*PU(1,2)*ST(1,1)*s(2)*s(3))*EQQQ(9,6,8)...
            + (PU(2,3)*ST(1,3)*s(1)*s(3)-PU(3,2)*ST(1,3)*s(1)*s(2)+PU(3,1)*ST(2,3)*s(1)*s(2)-PU(2,1)*ST(3,3)*s(1)*s(3)+PU(3,3)*ST(2,1)*s(2)*s(3)-PU(3,2)*ST(3,1)*s(2)*s(3))*EQQQ(2,6,7)...
            + (PU(3,2)*ST(3,1)*s(2)^2-PU(3,3)*ST(2,1)*s(2)^2-PU(2,3)*ST(1,3)*s(1)*s(2)+PU(3,2)*ST(1,3)*s(1)*s(3)+PU(2,1)*ST(3,3)*s(1)*s(2)-PU(3,1)*ST(2,3)*s(1)*s(3))*EQQQ(4,3,6)...
            + (PU(2,1)*ST(3,3)*s(3)^2-PU(2,3)*ST(1,3)*s(3)^2-PU(3,2)*ST(1,3)*s(2)*s(3)+PU(3,3)*ST(2,1)*s(1)*s(2)+PU(3,1)*ST(2,3)*s(2)*s(3)-PU(3,2)*ST(3,1)*s(1)*s(2))*EQQQ(2,6,3)...
            + (PU(3,2)*ST(1,3)*s(2)^2-PU(3,1)*ST(2,3)*s(2)^2+PU(2,3)*ST(1,3)*s(2)*s(3)-PU(3,3)*ST(2,1)*s(1)*s(3)-PU(2,1)*ST(3,3)*s(2)*s(3)+PU(3,2)*ST(3,1)*s(1)*s(3))*EQQQ(3,8,2);
        EvRvRPUGammat(1,3) = (PU(1,3)*ST(2,2)*s(2)^2+PU(1,3)*ST(2,2)*s(3)^2-PU(1,2)*ST(3,2)*s(2)^2-PU(1,2)*ST(3,2)*s(3)^2)*EQQQ(1,6,6)...
            + (2*PU(1,2)*ST(3,2)*s(2)*s(3)-2*PU(1,3)*ST(2,2)*s(2)*s(3))*EQQQ(1,6,8)...
            + (PU(1,3)*ST(1,1)*s(2)^2+PU(1,3)*ST(1,1)*s(3)^2-PU(1,1)*ST(3,1)*s(2)^2-PU(1,1)*ST(3,1)*s(3)^2)*EQQQ(5,6,6)...
            + (2*PU(1,1)*ST(3,1)*s(2)*s(3)-2*PU(1,3)*ST(1,1)*s(2)*s(3))*EQQQ(5,6,8)...
            + (PU(3,2)*ST(1,2)*s(1)*s(2)-PU(2,3)*ST(1,2)*s(1)*s(3)-PU(2,3)*ST(2,1)*s(2)*s(3)-PU(3,1)*ST(2,2)*s(1)*s(2)+PU(2,1)*ST(3,2)*s(1)*s(3)+PU(2,2)*ST(3,1)*s(2)*s(3))*EQQQ(2,6,7)...
            + (PU(2,3)*ST(2,1)*s(3)^2-PU(2,2)*ST(3,1)*s(3)^2+PU(2,3)*ST(1,2)*s(1)*s(2)-PU(3,2)*ST(1,2)*s(1)*s(3)-PU(2,1)*ST(3,2)*s(1)*s(2)+PU(3,1)*ST(2,2)*s(1)*s(3))*EQQQ(4,3,6)...
            + (PU(2,3)*ST(1,2)*s(3)^2-PU(2,1)*ST(3,2)*s(3)^2+PU(2,3)*ST(2,1)*s(1)*s(2)+PU(3,2)*ST(1,2)*s(2)*s(3)-PU(2,2)*ST(3,1)*s(1)*s(2)-PU(3,1)*ST(2,2)*s(2)*s(3))*EQQQ(2,6,3)...
            + (PU(3,1)*ST(2,2)*s(2)^2-PU(3,2)*ST(1,2)*s(2)^2-PU(2,3)*ST(1,2)*s(2)*s(3)-PU(2,3)*ST(2,1)*s(1)*s(3)+PU(2,2)*ST(3,1)*s(1)*s(3)+PU(2,1)*ST(3,2)*s(2)*s(3))*EQQQ(3,8,2);
        EvRvRPUGammat(2,1) = (PU(2,1)*ST(3,3)*s(1)^2-PU(2,3)*ST(1,3)*s(3)^2-PU(2,3)*ST(1,3)*s(1)^2+PU(2,1)*ST(3,3)*s(3)^2)*EQQQ(5,3,3)...
            + (2*PU(2,3)*ST(1,3)*s(1)*s(3)-2*PU(2,1)*ST(3,3)*s(1)*s(3))*EQQQ(5,3,7)...
            + (PU(2,1)*ST(2,2)*s(1)^2-PU(2,2)*ST(1,2)*s(3)^2-PU(2,2)*ST(1,2)*s(1)^2+PU(2,1)*ST(2,2)*s(3)^2)*EQQQ(9,3,3)...
            + (2*PU(2,2)*ST(1,2)*s(1)*s(3)-2*PU(2,1)*ST(2,2)*s(1)*s(3))*EQQQ(9,3,7)...
            + (PU(1,3)*ST(2,3)*s(2)*s(3)+PU(3,2)*ST(1,3)*s(1)*s(2)+PU(3,3)*ST(1,2)*s(1)*s(3)-PU(1,2)*ST(3,3)*s(2)*s(3)-PU(3,1)*ST(2,3)*s(1)*s(2)-PU(3,1)*ST(3,2)*s(1)*s(3))*EQQQ(2,6,7)...
            + (PU(1,2)*ST(3,3)*s(3)^2-PU(1,3)*ST(2,3)*s(3)^2+PU(3,3)*ST(1,2)*s(1)*s(2)+PU(3,2)*ST(1,3)*s(1)*s(3)-PU(3,1)*ST(2,3)*s(1)*s(3)-PU(3,1)*ST(3,2)*s(1)*s(2))*EQQQ(4,3,6)...
            + (PU(3,1)*ST(3,2)*s(1)^2-PU(3,3)*ST(1,2)*s(1)^2-PU(1,3)*ST(2,3)*s(1)*s(2)+PU(1,2)*ST(3,3)*s(1)*s(2)-PU(3,2)*ST(1,3)*s(2)*s(3)+PU(3,1)*ST(2,3)*s(2)*s(3))*EQQQ(2,6,3)...
            + (PU(3,1)*ST(2,3)*s(1)^2-PU(3,2)*ST(1,3)*s(1)^2+PU(1,3)*ST(2,3)*s(1)*s(3)-PU(1,2)*ST(3,3)*s(1)*s(3)-PU(3,3)*ST(1,2)*s(2)*s(3)+PU(3,1)*ST(3,2)*s(2)*s(3))*EQQQ(3,8,2);
        EvRvRPUGammat(2,2) = (PU(2,2)*ST(3,3)*s(1)^2-PU(2,3)*ST(2,3)*s(3)^2-PU(2,3)*ST(2,3)*s(1)^2+PU(2,2)*ST(3,3)*s(3)^2)*EQQQ(1,3,3)...
            + (2*PU(2,3)*ST(2,3)*s(1)*s(3)-2*PU(2,2)*ST(3,3)*s(1)*s(3))*EQQQ(1,3,7)...
            + (PU(2,2)*ST(1,1)*s(1)^2+PU(2,2)*ST(1,1)*s(3)^2-PU(2,1)*ST(2,1)*s(1)^2-PU(2,1)*ST(2,1)*s(3)^2)*EQQQ(9,3,3)...
            + (2*PU(2,1)*ST(2,1)*s(1)*s(3)-2*PU(2,2)*ST(1,1)*s(1)*s(3))*EQQQ(9,3,7)...
            + (PU(1,3)*ST(1,3)*s(1)*s(3)-PU(1,1)*ST(3,3)*s(1)*s(3)-PU(3,3)*ST(1,1)*s(1)*s(3)+PU(3,1)*ST(3,1)*s(1)*s(3))*EQQQ(2,6,7)...
            + (PU(1,1)*ST(3,3)*s(1)*s(2)-PU(1,3)*ST(1,3)*s(1)*s(2)-PU(3,3)*ST(1,1)*s(1)*s(2)+PU(3,1)*ST(3,1)*s(1)*s(2))*EQQQ(4,3,6)...
            + (PU(3,3)*ST(1,1)*s(1)^2-PU(1,3)*ST(1,3)*s(3)^2+PU(1,1)*ST(3,3)*s(3)^2-PU(3,1)*ST(3,1)*s(1)^2)*EQQQ(2,6,3)...
            + (PU(1,3)*ST(1,3)*s(2)*s(3)-PU(1,1)*ST(3,3)*s(2)*s(3)+PU(3,3)*ST(1,1)*s(2)*s(3)-PU(3,1)*ST(3,1)*s(2)*s(3))*EQQQ(3,8,2);
        EvRvRPUGammat(2,3) = (PU(2,3)*ST(2,2)*s(1)^2+PU(2,3)*ST(2,2)*s(3)^2-PU(2,2)*ST(3,2)*s(1)^2-PU(2,2)*ST(3,2)*s(3)^2)*EQQQ(1,3,3)...
            + (2*PU(2,2)*ST(3,2)*s(1)*s(3)-2*PU(2,3)*ST(2,2)*s(1)*s(3))*EQQQ(1,3,7)...
            + (PU(2,3)*ST(1,1)*s(1)^2+PU(2,3)*ST(1,1)*s(3)^2-PU(2,1)*ST(3,1)*s(1)^2-PU(2,1)*ST(3,1)*s(3)^2)*EQQQ(5,3,3)...
            + (2*PU(2,1)*ST(3,1)*s(1)*s(3)-2*PU(2,3)*ST(1,1)*s(1)*s(3))*EQQQ(5,3,7)...
            + (PU(1,1)*ST(3,2)*s(1)*s(3)-PU(1,3)*ST(2,1)*s(2)*s(3)-PU(3,2)*ST(1,1)*s(1)*s(2)-PU(1,3)*ST(1,2)*s(1)*s(3)+PU(1,2)*ST(3,1)*s(2)*s(3)+PU(3,1)*ST(2,1)*s(1)*s(2))*EQQQ(2,6,7)...
            + (PU(1,3)*ST(2,1)*s(3)^2-PU(1,2)*ST(3,1)*s(3)^2+PU(1,3)*ST(1,2)*s(1)*s(2)-PU(1,1)*ST(3,2)*s(1)*s(2)-PU(3,2)*ST(1,1)*s(1)*s(3)+PU(3,1)*ST(2,1)*s(1)*s(3))*EQQQ(4,3,6)...
            + (PU(1,3)*ST(1,2)*s(3)^2-PU(1,1)*ST(3,2)*s(3)^2+PU(1,3)*ST(2,1)*s(1)*s(2)-PU(1,2)*ST(3,1)*s(1)*s(2)+PU(3,2)*ST(1,1)*s(2)*s(3)-PU(3,1)*ST(2,1)*s(2)*s(3))*EQQQ(2,6,3)...
            + (PU(3,2)*ST(1,1)*s(1)^2-PU(3,1)*ST(2,1)*s(1)^2-PU(1,3)*ST(1,2)*s(2)*s(3)-PU(1,3)*ST(2,1)*s(1)*s(3)+PU(1,2)*ST(3,1)*s(1)*s(3)+PU(1,1)*ST(3,2)*s(2)*s(3))*EQQQ(3,8,2);
        EvRvRPUGammat(3,1) = (PU(3,1)*ST(3,3)*s(1)^2-PU(3,3)*ST(1,3)*s(2)^2-PU(3,3)*ST(1,3)*s(1)^2+PU(3,1)*ST(3,3)*s(2)^2)*EQQQ(5,2,2)...
            + (2*PU(3,3)*ST(1,3)*s(1)*s(2)-2*PU(3,1)*ST(3,3)*s(1)*s(2))*EQQQ(5,2,4)...
            + (PU(3,1)*ST(2,2)*s(1)^2-PU(3,2)*ST(1,2)*s(2)^2-PU(3,2)*ST(1,2)*s(1)^2+PU(3,1)*ST(2,2)*s(2)^2)*EQQQ(9,2,2)...
            + (2*PU(3,2)*ST(1,2)*s(1)*s(2)-2*PU(3,1)*ST(2,2)*s(1)*s(2))*EQQQ(9,2,4)...
            + (PU(2,2)*ST(1,3)*s(1)*s(2)+PU(2,3)*ST(1,2)*s(1)*s(3)-PU(1,3)*ST(2,2)*s(2)*s(3)-PU(2,1)*ST(2,3)*s(1)*s(2)+PU(1,2)*ST(3,2)*s(2)*s(3)-PU(2,1)*ST(3,2)*s(1)*s(3))*EQQQ(2,6,7)...
            + (PU(1,3)*ST(2,2)*s(2)^2-PU(1,2)*ST(3,2)*s(2)^2+PU(2,3)*ST(1,2)*s(1)*s(2)+PU(2,2)*ST(1,3)*s(1)*s(3)-PU(2,1)*ST(2,3)*s(1)*s(3)-PU(2,1)*ST(3,2)*s(1)*s(2))*EQQQ(4,3,6)...
            + (PU(2,1)*ST(3,2)*s(1)^2-PU(2,3)*ST(1,2)*s(1)^2-PU(1,3)*ST(2,2)*s(1)*s(2)-PU(2,2)*ST(1,3)*s(2)*s(3)+PU(1,2)*ST(3,2)*s(1)*s(2)+PU(2,1)*ST(2,3)*s(2)*s(3))*EQQQ(2,6,3)...
            + (PU(2,1)*ST(2,3)*s(1)^2-PU(2,2)*ST(1,3)*s(1)^2+PU(1,3)*ST(2,2)*s(1)*s(3)-PU(2,3)*ST(1,2)*s(2)*s(3)-PU(1,2)*ST(3,2)*s(1)*s(3)+PU(2,1)*ST(3,2)*s(2)*s(3))*EQQQ(3,8,2);
        EvRvRPUGammat(3,2) = (PU(3,2)*ST(3,3)*s(1)^2-PU(3,3)*ST(2,3)*s(2)^2-PU(3,3)*ST(2,3)*s(1)^2+PU(3,2)*ST(3,3)*s(2)^2)*EQQQ(1,2,2)...
            + (2*PU(3,3)*ST(2,3)*s(1)*s(2)-2*PU(3,2)*ST(3,3)*s(1)*s(2))*EQQQ(1,2,4)...
            + (PU(3,2)*ST(1,1)*s(1)^2+PU(3,2)*ST(1,1)*s(2)^2-PU(3,1)*ST(2,1)*s(1)^2-PU(3,1)*ST(2,1)*s(2)^2)*EQQQ(9,2,2)...
            + (2*PU(3,1)*ST(2,1)*s(1)*s(2)-2*PU(3,2)*ST(1,1)*s(1)*s(2))*EQQQ(9,2,4)...
            + (PU(1,1)*ST(2,3)*s(1)*s(2)-PU(1,2)*ST(1,3)*s(1)*s(2)-PU(2,3)*ST(1,1)*s(1)*s(3)+PU(1,3)*ST(2,1)*s(2)*s(3)-PU(1,2)*ST(3,1)*s(2)*s(3)+PU(2,1)*ST(3,1)*s(1)*s(3))*EQQQ(2,6,7)...
            + (PU(1,2)*ST(3,1)*s(2)^2-PU(1,3)*ST(2,1)*s(2)^2+PU(1,2)*ST(1,3)*s(1)*s(3)-PU(2,3)*ST(1,1)*s(1)*s(2)-PU(1,1)*ST(2,3)*s(1)*s(3)+PU(2,1)*ST(3,1)*s(1)*s(2))*EQQQ(4,3,6)...
            + (PU(2,3)*ST(1,1)*s(1)^2-PU(2,1)*ST(3,1)*s(1)^2-PU(1,2)*ST(1,3)*s(2)*s(3)+PU(1,3)*ST(2,1)*s(1)*s(2)+PU(1,1)*ST(2,3)*s(2)*s(3)-PU(1,2)*ST(3,1)*s(1)*s(2))*EQQQ(2,6,3)...
            + (PU(1,2)*ST(1,3)*s(2)^2-PU(1,1)*ST(2,3)*s(2)^2-PU(1,3)*ST(2,1)*s(1)*s(3)+PU(2,3)*ST(1,1)*s(2)*s(3)+PU(1,2)*ST(3,1)*s(1)*s(3)-PU(2,1)*ST(3,1)*s(2)*s(3))*EQQQ(3,8,2);
        EvRvRPUGammat(3,3) = (PU(3,3)*ST(2,2)*s(1)^2+PU(3,3)*ST(2,2)*s(2)^2-PU(3,2)*ST(3,2)*s(1)^2-PU(3,2)*ST(3,2)*s(2)^2)*EQQQ(1,2,2)...
            + (2*PU(3,2)*ST(3,2)*s(1)*s(2)-2*PU(3,3)*ST(2,2)*s(1)*s(2))*EQQQ(1,2,4)...
            + (PU(3,3)*ST(1,1)*s(1)^2+PU(3,3)*ST(1,1)*s(2)^2-PU(3,1)*ST(3,1)*s(1)^2-PU(3,1)*ST(3,1)*s(2)^2)*EQQQ(5,2,2)...
            + (2*PU(3,1)*ST(3,1)*s(1)*s(2)-2*PU(3,3)*ST(1,1)*s(1)*s(2))*EQQQ(5,2,4)...
            + (PU(1,2)*ST(1,2)*s(1)*s(2)-PU(1,1)*ST(2,2)*s(1)*s(2)-PU(2,2)*ST(1,1)*s(1)*s(2)+PU(2,1)*ST(2,1)*s(1)*s(2))*EQQQ(2,6,7)...
            + (PU(1,1)*ST(2,2)*s(1)*s(3)-PU(1,2)*ST(1,2)*s(1)*s(3)-PU(2,2)*ST(1,1)*s(1)*s(3)+PU(2,1)*ST(2,1)*s(1)*s(3))*EQQQ(4,3,6)...
            + (PU(1,2)*ST(1,2)*s(2)*s(3)-PU(1,1)*ST(2,2)*s(2)*s(3)+PU(2,2)*ST(1,1)*s(2)*s(3)-PU(2,1)*ST(2,1)*s(2)*s(3))*EQQQ(2,6,3)...
            + (PU(2,2)*ST(1,1)*s(1)^2-PU(1,2)*ST(1,2)*s(2)^2+PU(1,1)*ST(2,2)*s(2)^2-PU(2,1)*ST(2,1)*s(1)^2)*EQQQ(3,8,2);
        
        ExvRhatxwpt = dt*(Sigmac*U*EGammat'+Miu*EvRPUGammat+P*EvRvRPUGammat)*VT';
    end
end

% ExvRhatHWpt
G = H*H';

if omegaLocal
    VTT = Vtdt'*expRot((omega+Miu)*dt)'*G'*V;
else
    UTT = Utdt'*expRot((omega+Miu)*dt)*G*U;
end

if defQS
    if omegaLocal
        STT = UT'*Stdt*VTT;
        EvRTTt = UT*vee(EQ*STT'-STT*EQ');
        
        EvRvRTTt = [STT(2,2)*EQ(2,2)+STT(3,3)*EQ(3,3), -STT(1,2)*EQ(2,2), -STT(1,3)*EQ(3,3)
            -STT(2,1)*EQ(1,1), STT(1,1)*EQ(1,1)+STT(3,3)*EQ(3,3), -STT(2,3)*EQ(3,3)
            -STT(3,1)*EQ(1,1), -STT(3,2)*EQ(2,2), STT(1,1)*EQ(1,1)+STT(2,2)*EQ(2,2)];
        EvRvRTTt = EvRvRTTt*UT';
    else
        SV = Stdt*VT;
        EvRTTt = vee(UTT*EQ*SV'-SV*EQ'*UTT');
        
        EvRvRTTt(1,1) = (SV(2,2)*UTT(3,3)-SV(3,2)*UTT(2,3))*EQ(2,2) + (SV(3,3)*UTT(2,2)-SV(2,3)*UTT(3,2))*EQ(3,3);
        EvRvRTTt(1,2) = (SV(3,2)*UTT(1,3)-SV(1,2)*UTT(3,3))*EQ(2,2) + (SV(1,3)*UTT(3,2)-SV(3,3)*UTT(1,2))*EQ(3,3);
        EvRvRTTt(1,3) = (SV(1,2)*UTT(2,3)-SV(2,2)*UTT(1,3))*EQ(2,2) + (SV(2,3)*UTT(1,2)-SV(1,3)*UTT(2,2))*EQ(3,3);
        EvRvRTTt(2,1) = (SV(3,1)*UTT(2,3)-SV(2,1)*UTT(3,3))*EQ(1,1) + (SV(2,3)*UTT(3,1)-SV(3,3)*UTT(2,1))*EQ(3,3);
        EvRvRTTt(2,2) = (SV(1,1)*UTT(3,3)-SV(3,1)*UTT(1,3))*EQ(1,1) + (SV(3,3)*UTT(1,1)-SV(1,3)*UTT(3,1))*EQ(3,3);
        EvRvRTTt(2,3) = (SV(2,1)*UTT(1,3)-SV(1,1)*UTT(2,3))*EQ(1,1) + (SV(1,3)*UTT(2,1)-SV(2,3)*UTT(1,1))*EQ(3,3);
        EvRvRTTt(3,1) = (SV(2,1)*UTT(3,2)-SV(3,1)*UTT(2,2))*EQ(1,1) + (SV(3,2)*UTT(2,1)-SV(2,2)*UTT(3,1))*EQ(2,2);
        EvRvRTTt(3,2) = (SV(3,1)*UTT(1,2)-SV(1,1)*UTT(3,2))*EQ(1,1) + (SV(1,2)*UTT(3,1)-SV(3,2)*UTT(1,1))*EQ(2,2);
        EvRvRTTt(3,3) = (SV(1,1)*UTT(2,2)-SV(2,1)*UTT(1,2))*EQ(1,1) + (SV(2,2)*UTT(1,1)-SV(1,2)*UTT(2,1))*EQ(2,2);
    end
else
    if omegaLocal
        SU = Stdt*UT;
        EvRTTt = vee(SU*EQ*VTT'-VTT*EQ'*SU');
        
        EvRvRTTt(1,1) = (SU(2,2)*VTT(3,3)-SU(3,2)*VTT(2,3))*EQ(2,2) + (SU(3,3)*VTT(2,2)-SU(2,3)*VTT(3,2))*EQ(3,3);
        EvRvRTTt(1,2) = (SU(3,2)*VTT(1,3)-SU(1,2)*VTT(3,3))*EQ(2,2) + (SU(1,3)*VTT(3,2)-SU(3,3)*VTT(1,2))*EQ(3,3);
        EvRvRTTt(1,3) = (SU(1,2)*VTT(2,3)-SU(2,2)*VTT(1,3))*EQ(2,2) + (SU(2,3)*VTT(1,2)-SU(1,3)*VTT(2,2))*EQ(3,3);
        EvRvRTTt(2,1) = (SU(3,1)*VTT(2,3)-SU(2,1)*VTT(3,3))*EQ(1,1) + (SU(2,3)*VTT(3,1)-SU(3,3)*VTT(2,1))*EQ(3,3);
        EvRvRTTt(2,2) = (SU(1,1)*VTT(3,3)-SU(3,1)*VTT(1,3))*EQ(1,1) + (SU(3,3)*VTT(1,1)-SU(1,3)*VTT(3,1))*EQ(3,3);
        EvRvRTTt(2,3) = (SU(2,1)*VTT(1,3)-SU(1,1)*VTT(2,3))*EQ(1,1) + (SU(1,3)*VTT(2,1)-SU(2,3)*VTT(1,1))*EQ(3,3);
        EvRvRTTt(3,1) = (SU(2,1)*VTT(3,2)-SU(3,1)*VTT(2,2))*EQ(1,1) + (SU(3,2)*VTT(2,1)-SU(2,2)*VTT(3,1))*EQ(2,2);
        EvRvRTTt(3,2) = (SU(3,1)*VTT(1,2)-SU(1,1)*VTT(3,2))*EQ(1,1) + (SU(1,2)*VTT(3,1)-SU(3,2)*VTT(1,1))*EQ(2,2);
        EvRvRTTt(3,3) = (SU(1,1)*VTT(2,2)-SU(2,1)*VTT(1,2))*EQ(1,1) + (SU(2,2)*VTT(1,1)-SU(1,2)*VTT(2,1))*EQ(2,2);
    else
        STT = UTT'*Stdt*VT;
        EvRTTt = VT*vee(STT'*EQ-EQ'*STT);
        
        EvRvRTTt = [STT(2,2)*EQ(2,2)+STT(3,3)*EQ(3,3), -STT(2,1)*EQ(2,2), -STT(3,1)*EQ(3,3)
            -STT(1,2)*EQ(1,1), STT(1,1)*EQ(1,1)+STT(3,3)*EQ(3,3), -STT(3,2)*EQ(3,3)
            -STT(1,3)*EQ(1,1), -STT(2,3)*EQ(2,2), STT(1,1)*EQ(1,1)+STT(2,2)*EQ(2,2)];
        EvRvRTTt = EvRvRTTt*VT';
    end
end

ExvRGwpt = Miu*EvRTTt'+P*EvRvRTTt;
ExvRhatHWwpt = dt*ExvRGwpt - dt*trace(G)*ExvRTt;

% final result
ExvRtdt = ExvRTt + ExvRhatxwpt + 0.5*ExvRhatHWwpt;

end

